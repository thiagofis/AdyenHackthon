/*!
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

/*! VelocityJS.org (1.2.3). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License */

/*! VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/wiki/MIT_License. */

/* Technique by Erik Moller. MIT license: https://gist.github.com/paulirish/1579671 */

/* Array compacting. Copyright Lo-Dash. MIT License: https://github.com/lodash/lodash/blob/master/LICENSE.txt */

/* Copyright Martin Bohm. MIT License: https://gist.github.com/Tomalak/818a78a226a0738eaade */

/* Bezier curve function generator. Copyright Gaetan Renaudeau. MIT License: http://en.wikipedia.org/wiki/MIT_License */

/* Runge-Kutta spring physics function generator. Adapted from Framer.js, copyright Koen Bok. MIT License: http://en.wikipedia.org/wiki/MIT_License */

/* Hex to RGB conversion. Copyright Tim Down: http://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb */

define("notifierConstants",{ID:"mod-notifications",NAME:"Notifier",ERROR:"error",WARNING:"warning",MESSAGE_SELECTOR:".js-message",CLOSE_BUTTON_SELECOTR:".js-close-notification",events:{DISPLAY_NOTIFICATION:"DISPLAY_NOTIFICATION",DISMISS_NOTIFICATION:"DISMISS_NOTIFICATION"}}),define("notifierMethods",["pub_sub","notifierConstants"],function(e,t){function i(){if(s=document.getElementById(t.ID),!s)throw t.NAME+" is not loaded! Check if you have a node with the id: "+t.ID;n=s.querySelector(t.MESSAGE_SELECTOR),o=s.querySelector(t.CLOSE_BUTTON_SELECOTR),a.closeButtonClickCallback(a.hide)}var r=[t.ERROR,t.WARNING],s=null,n=null,o=null,a={getType:function(){return s.dataset&&r.indexOf[s.dataset.type]>-1?s.dataset.type:t.ERROR},setType:function(e){var i=e.trim().toLowerCase();r.indexOf[i]<0&&(i=t.ERROR),s.dataset&&(s.dataset.type=i)},setMessage:function(e){return n&&"string"==typeof e&&e.trim().length>0?(n.innerHTML=e,!0):!1},show:function(){s.classList.contains("hide")&&(s.classList.remove("hide"),e.emit(t.events.DISPLAY_NOTIFICATION))},hide:function(){s.classList.contains("hide")||(s.classList.add("hide"),e.emit(t.events.DISMISS_NOTIFICATION))},closeButtonClickCallback:function(e){o.addEventListener("click",e)}};return i(),a}),define("notifier",["notifierMethods","notifierConstants"],function(e,t){var i=function(){};return i.prototype={displayError:function(i){e.setType(t.ERROR),e.setMessage(i),e.show()},displayWarning:function(i){e.setType(t.WARNING),e.setMessage(i),e.show()},dismiss:function(){e.hide()}},new i}),define("trackerMethods",["core","pub_sub","constants"],function(e,t,i){var r,s,n="uniquePixelId",o={readCookie:function(e){return(document.cookie.match("(^|; )"+e+"=([^;]*)")||0)[2]},insertPixel:function(o){universal_variable=universal_variable||uv||{},universal_variable.user=universal_variable.user||{},universal_variable.page=universal_variable.page||{};var a={purl:window.location.href,ssid:universal_variable.user.sessionId,cid:universal_variable.user.country_id,ild:universal_variable.user.isLogged,hv:"Z",ckt:universal_variable.user.checkoutType,irt:universal_variable.user.returning,bid:universal_variable.user.basketId||0,iid:universal_variable.user.instanceId||0,ckid:universal_variable.user.cookieId,ip:universal_variable.user.ip,ag:window.navigator.userAgent,ifrs:universal_variable.page.flatShipRate,ref:document.referrer,qlab:this.readCookie("qubit_land_ab"),blg:navigator.language||navigator.userLanguage,sfd:universal_variable.page.subfolder,usfd:universal_variable.user.userSubfolder,gsfd:universal_variable.user.geoSubfolder,pgid:universal_variable.page.pageId||"checkout",jrd:universal_variable.user.just_registered,ret:universal_variable.user.returning,ibt:universal_variable.user.isBot,rnd:+new Date,uid:universal_variable.user.user_id||null},l=e.extend({},o,a);this.pixelEndPoint=s+"?"+e.params(l),t.emit(i.events.TRK_FIRED,this.pixelEndPoint),r&&1===r.nodeType?r.src=this.pixelEndPoint:(r=document.createElement("IMG"),r.src=this.pixelEndPoint,r.setAttribute("async",""),r.setAttribute("alt",n),r.id=n,r.setAttribute("class","hide"),document.body.appendChild(r))},extractTrkInfo:function(e){var t;return"object"==typeof e&&e.hasOwnProperty("el")?t="object"==typeof e.el&&1===e.el.nodeType?e.el.dataset.trk:void 0:"object"==typeof e&&1===e.nodeType&&(t=e.dataset.trk),t},parse:function(e,t,i){var r=parseInt(e),s=null;if(!isNaN(r))return"object"==typeof i&&(i=JSON.parse(i)),s={tid:"undefined"!=typeof t?t:r,val:"undefined"!=typeof i?i:null};try{s=JSON.parse(e)}catch(n){if(!t)return s=null;s={}}return t&&(s.tid=t),i&&(s.val=i),s},scanPage:function(){s=document.body.getAttribute("data-trk-endpoint");for(var e=document.querySelectorAll("[data-trk]"),r=e.length,n=0;r>n;n++)e[n].addEventListener("click",function(e){t.emit(i.events.TRK,e.currentTarget)})}};return o}),define("tracker",["pub_sub","constants","trackerMethods"],function(e,t,i){var r={track:function(e){debug&&console.log("TRACKER => ",e);var t=i.extractTrkInfo(e),r=i.parse(t,e.tid,e.val);r&&r.tid&&(r.tt=1,i.insertPixel(r))},init:function(){this.loadEvents()},loadEvents:function(){i.scanPage(),e.on(t.events.TRK,this.track)}};return r.init(),r}),define("Base",["notifier","tracker"],function(e,t){var i={},r={displayNotifier:function(t){t.error?e.displayError(t.error.message):e.displayError(t.statusText)},addModule:function(e,t,r){return!t||i.hasOwnProperty(e)?!1:(i[e]=t,r&&i[e].init(),!0)},store:function(e,t,i){return this.getModule(e)?!1:this.addModule(e,t,i)},removeModule:function(e){return i.hasOwnProperty(e)?(i[e].unload&&i[e].unload(),void delete i[e]):!0},unloadModules:function(){for(var e in i)i[e].unload&&i[e].unload()},getModule:function(e){return i.hasOwnProperty(e)?i[e]:null},pageLoaded:function(){document.body.classList.remove("loading")}};return r}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("es6ObjectAssign",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.ObjectAssign=e()}}(function(){return function e(t,i,r){function s(o,a){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(n)return n(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return s(i?i:e)},c,c.exports,e,t,i,r)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(e,t,i){function r(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var i=Object(e),r=1;r<arguments.length;r++){var s=arguments[r];if(void 0!==s&&null!==s)for(var n=Object.keys(Object(s)),o=0,a=n.length;a>o;o++){var l=n[o],d=Object.getOwnPropertyDescriptor(s,l);void 0!==d&&d.enumerable&&(i[l]=s[l])}}return i}function s(){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:r})}t.exports={assign:r,polyfill:s}},{}]},{},[1])(1)}),define("popoverMethods",[],function(){var e={start:function(e){var t="onmouseleave"in e._link?["mouseenter","mouseleave"]:["mouseover","mouseout"];"hover"===e._options.trigger?(e._link.addEventListener(t[0],e.open,!1),e._options.dismiss||e._link.addEventListener(t[1],e.close,!1)):"click"===e._options.trigger?(e._link.addEventListener("click",e.toggle,!1),e._options.dismiss||(document.addEventListener("click",e.close,!0),document.addEventListener("touchstart",e.close,!0))):"focus"===e._options.trigger&&(e._link.addEventListener("focus",e.toggle,!1),e._options.dismiss||e._link.addEventListener("blur",e.close,!1)),e._options.dismiss&&(document.addEventListener("click",e.close,!0),document.addEventListener("touchstart",e.close,!0)),e._isIE&&e._isIE<9||window.addEventListener("resize",e.close,!1)},createPopover:function(e){if(e._popover=document.createElement("div"),null!==e._content&&null===e._options.template){e._popover.setAttribute("role","tooltip");var t=document.createElement("div");if(t.setAttribute("class","arrow"),null!==e._title){var i=document.createElement("h3");i.setAttribute("class","popover-title"),e._options.dismiss?i.innerHTML=e._title+'<button type="button" class="close">×</button>':i.innerHTML=e._title,e._popover.appendChild(i)}var r=document.createElement("div");r.setAttribute("class","popover-content"),e._popover.appendChild(t),e._popover.appendChild(r),e._options.dismiss&&null===e._title?r.innerHTML=e._content+'<button type="button" class="close">×</button>':r.innerHTML=e._content}else{var s=document.createElement("div");if(e._options.template){var n=e._options.template;n&&(s.innerHTML=n.innerHTML,e._popover.innerHTML=s.innerHTML)}}e._options.container.appendChild(e._popover),e._popover.style.display="block"},stylePopover:function(e,t){e._rect=this.getRect(e);var i=t||e._options.placement,r="true"===e._options.animation?"fade":"";e._popover.setAttribute("class","popover "+i+" "+r);var s={w:e._link.offsetWidth,h:e._link.offsetHeight},n=this.popoverDimensions(e._popover),o={w:n.w,h:n.h},a=this.getScroll().y,l=this.getScroll().x;/top/.test(i)?(e._popover.style.top=e._rect.top+a-o.h+"px",e._popover.style.left=e._rect.left+l-o.w/2+s.w/2+"px"):/bottom/.test(i)?(e._popover.style.top=e._rect.top+a+s.h+"px",e._popover.style.left=e._rect.left+l-o.w/2+s.w/2+"px"):/left/.test(i)?(e._popover.style.top=e._rect.top+a-o.h/2+s.h/2+"px",e._popover.style.left=e._rect.left+l-o.w+"px"):/right/.test(i)&&(e._popover.style.top=e._rect.top+a-o.h/2+s.h/2+"px",e._popover.style.left=e._rect.left+l+s.w+"px")},updatePopover:function(e){var t;t=this.isElementInViewport(e._popover)?e._options.placement:this.updatePlacement(e),this.stylePopover(e,t),e._popover.className+=" in"},updatePlacement:function(e){var t=e._options.placement;return/top/.test(t)?"bottom":/bottom/.test(t)?"top":/left/.test(t)?"right":/right/.test(t)?"left":void 0},getRect:function(e){return e._link.getBoundingClientRect()},getScroll:function(){return{y:window.pageYOffset||document.documentElement.scrollTop,x:window.pageXOffset||document.documentElement.scrollLeft}},popoverDimensions:function(e){return{w:e.offsetWidth,h:e.offsetHeight}},isElementInViewport:function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}};return e}),define("popover",["popoverMethods"],function(e){var t="popover-open",i="popover-close",r=function(t){this._isIE=null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)?parseFloat(RegExp.$1):!1,this._link="object"==typeof t?t:document.querySelector(t),this._title=this._link.getAttribute("data-title")||null,this._content=this._link.getAttribute("data-content")||null,this._popover=null,this._options={},this._options.template=this._link.getAttribute("data-template")?document.getElementById(this._link.getAttribute("data-template")):null,this._options.trigger=this._link.getAttribute("data-trigger")?this._link.getAttribute("data-trigger"):"hover",this._options.animation=this._link.getAttribute("data-animation")&&"true"!==this._link.getAttribute("data-animation")?this._link.getAttribute("data-animation"):"true",this._options.placement=this._link.getAttribute("data-placement")?this._link.getAttribute("data-placement"):"top",this._options.dismiss="true"===this._link.getAttribute("data-dismiss")?!0:!1,this._options.delay=parseInt(this._link.getAttribute("data-delay"),10)||100,this._options.duration=this._isIE&&this._isIE<10?0:this._link.getAttribute("data-duration")||0,this._options.container=document.body,(this._content||this._options.template)&&(this.actions(this),e.start(this)),this._timer=0,this._rect=null};return r.prototype={events:{POPOVER_OPENED:t,POPOVER_CLOSED:i},actions:function(r){var s=r;this.generateEvent=function(e){var t=document.createEvent("Event");t.initEvent(e,!0,!0),s._link.dispatchEvent(t)},this.toggle=function(e){e.preventDefault(),null===r._popover?s.open():s.close()},this.open=function(){clearTimeout(r._link.getAttribute("data-timer")),r._timer=setTimeout(function(){null===r._popover&&(e.createPopover(r),e.stylePopover(r),e.updatePopover(r),s.generateEvent(t))},r._options.duration),r._link.setAttribute("data-timer",r._timer)},this.dismiss=function(e){r._popover&&s.close()},this.close=function(e){clearTimeout(r._link.getAttribute("data-timer")),r._timer=setTimeout(function(){r._popover&&null!==r._popover&&/in/.test(r._popover.className)&&(r._popover.className=r._popover.className.replace(" in",""),setTimeout(function(){s.removePopover(),s.generateEvent(i)},r._options.duration))},r._options.delay+r._options.duration),r._link.setAttribute("data-timer",r._timer)},this.removePopover=function(){r._popover&&r._options.container.removeChild(r._popover),r._popover=null,r._timer=null}}},r});var Hogan={};!function(e){function t(e,t,i){var r;return t&&"object"==typeof t&&(void 0!==t[e]?r=t[e]:i&&t.get&&"function"==typeof t.get&&(r=t.get(e))),r}function i(e,t,i,r,s,n){function o(){}function a(){}o.prototype=e,a.prototype=e.subs;var l,d=new o;d.subs=new a,d.subsText={},d.buf="",r=r||{},d.stackSubs=r,d.subsText=n;for(l in t)r[l]||(r[l]=t[l]);for(l in r)d.subs[l]=r[l];s=s||{},d.stackPartials=s;for(l in i)s[l]||(s[l]=i[l]);for(l in s)d.partials[l]=s[l];return d}function r(e){return String(null===e||void 0===e?"":e)}function s(e){return e=r(e),c.test(e)?e.replace(n,"&amp;").replace(o,"&lt;").replace(a,"&gt;").replace(l,"&#39;").replace(d,"&quot;"):e}e.Template=function(e,t,i,r){e=e||{},this.r=e.code||this.r,this.c=i,this.options=r||{},this.text=t||"",this.partials=e.partials||{},this.subs=e.subs||{},this.buf=""},e.Template.prototype={r:function(e,t,i){return""},v:s,t:r,render:function(e,t,i){return this.ri([e],t||{},i)},ri:function(e,t,i){return this.r(e,t,i)},ep:function(e,t){var r=this.partials[e],s=t[r.name];if(r.instance&&r.base==s)return r.instance;if("string"==typeof s){if(!this.c)throw new Error("No compiler available.");s=this.c.compile(s,this.options)}if(!s)return null;if(this.partials[e].base=s,r.subs){t.stackText||(t.stackText={});for(key in r.subs)t.stackText[key]||(t.stackText[key]=void 0!==this.activeSub&&t.stackText[this.activeSub]?t.stackText[this.activeSub]:this.text);s=i(s,r.subs,r.partials,this.stackSubs,this.stackPartials,t.stackText)}return this.partials[e].instance=s,s},rp:function(e,t,i,r){var s=this.ep(e,i);return s?s.ri(t,i,r):""},rs:function(e,t,i){var r=e[e.length-1];if(!u(r))return void i(e,t,this);for(var s=0;s<r.length;s++)e.push(r[s]),i(e,t,this),e.pop()},s:function(e,t,i,r,s,n,o){var a;return u(e)&&0===e.length?!1:("function"==typeof e&&(e=this.ms(e,t,i,r,s,n,o)),a=!!e,!r&&a&&t&&t.push("object"==typeof e?e:t[t.length-1]),a)},d:function(e,i,r,s){var n,o=e.split("."),a=this.f(o[0],i,r,s),l=this.options.modelGet,d=null;if("."===e&&u(i[i.length-2]))a=i[i.length-1];else for(var c=1;c<o.length;c++)n=t(o[c],a,l),void 0!==n?(d=a,a=n):a="";return s&&!a?!1:(s||"function"!=typeof a||(i.push(d),a=this.mv(a,i,r),i.pop()),a)},f:function(e,i,r,s){for(var n=!1,o=null,a=!1,l=this.options.modelGet,d=i.length-1;d>=0;d--)if(o=i[d],n=t(e,o,l),void 0!==n){a=!0;break}return a?(s||"function"!=typeof n||(n=this.mv(n,i,r)),n):s?!1:""},ls:function(e,t,i,s,n){var o=this.options.delimiters;return this.options.delimiters=n,this.b(this.ct(r(e.call(t,s)),t,i)),this.options.delimiters=o,!1},ct:function(e,t,i){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(e,this.options).render(t,i)},b:function(e){this.buf+=e},fl:function(){var e=this.buf;return this.buf="",e},ms:function(e,t,i,r,s,n,o){var a,l=t[t.length-1],d=e.call(l);return"function"==typeof d?r?!0:(a=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(d,l,i,a.substring(s,n),o)):d},mv:function(e,t,i){var s=t[t.length-1],n=e.call(s);return"function"==typeof n?this.ct(r(n.call(s)),s,i):n},sub:function(e,t,i,r){var s=this.subs[e];s&&(this.activeSub=e,s(t,i,this,r),this.activeSub=!1)}};var n=/&/g,o=/</g,a=/>/g,l=/\'/g,d=/\"/g,c=/[&<>\"\']/,u=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}}("undefined"!=typeof exports?exports:Hogan),function(e){function t(e){"}"===e.n.substr(e.n.length-1)&&(e.n=e.n.substring(0,e.n.length-1))}function i(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function r(e,t,i){if(t.charAt(i)!=e.charAt(0))return!1;for(var r=1,s=e.length;s>r;r++)if(t.charAt(i+r)!=e.charAt(r))return!1;return!0}function s(t,i,r,a){var l=[],d=null,c=null,u=null;for(c=r[r.length-1];t.length>0;){if(u=t.shift(),c&&"<"==c.tag&&!(u.tag in E))throw new Error("Illegal content in < super tag.");if(e.tags[u.tag]<=e.tags.$||n(u,a))r.push(u),u.nodes=s(t,u.tag,r,a);else{if("/"==u.tag){if(0===r.length)throw new Error("Closing tag without opener: /"+u.n);if(d=r.pop(),u.n!=d.n&&!o(u.n,d.n,a))throw new Error("Nesting error: "+d.n+" vs. "+u.n);return d.end=u.i,l}"\n"==u.tag&&(u.last=0==t.length||"\n"==t[0].tag)}l.push(u)}if(r.length>0)throw new Error("missing closing tag: "+r.pop().n);return l}function n(e,t){for(var i=0,r=t.length;r>i;i++)if(t[i].o==e.n)return e.tag="#",!0}function o(e,t,i){for(var r=0,s=i.length;s>r;r++)if(i[r].c==e&&i[r].o==t)return!0}function a(e){var t=[];for(var i in e)t.push('"'+d(i)+'": function(c,p,t,i) {'+e[i]+"}");return"{ "+t.join(",")+" }"}function l(e){var t=[];for(var i in e.partials)t.push('"'+d(i)+'":{name:"'+d(e.partials[i].name)+'", '+l(e.partials[i])+"}");return"partials: {"+t.join(",")+"}, subs: "+a(e.subs)}function d(e){return e.replace(y,"\\\\").replace(f,'\\"').replace(g,"\\n").replace(v,"\\r").replace(C,"\\u2028").replace(b,"\\u2029")}function c(e){return~e.indexOf(".")?"d":"f"}function u(e,t){var i="<"+(t.prefix||""),r=i+e.n+S++;return t.partials[r]={name:e.n,partials:{}},t.code+='t.b(t.rp("'+d(r)+'",c,p,"'+(e.indent||"")+'"));',r}function h(e,t){t.code+="t.b(t.t(t."+c(e.n)+'("'+d(e.n)+'",c,p,0)));'}function p(e){return"t.b("+e+");"}var m=/\S/,f=/\"/g,g=/\n/g,v=/\r/g,y=/\\/g,C=/\u2028/,b=/\u2029/;e.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},e.scan=function(s,n){function o(){y.length>0&&(C.push({tag:"_t",text:new String(y)}),y="")}function a(){for(var t=!0,i=S;i<C.length;i++)if(t=e.tags[C[i].tag]<e.tags._v||"_t"==C[i].tag&&null===C[i].text.match(m),!t)return!1;return t}function l(e,t){if(o(),e&&a())for(var i,r=S;r<C.length;r++)C[r].text&&((i=C[r+1])&&">"==i.tag&&(i.indent=C[r].text.toString()),C.splice(r,1));else t||C.push({tag:"\n"});b=!1,S=C.length}function d(e,t){var r="="+T,s=e.indexOf(r,t),n=i(e.substring(e.indexOf("=",t)+1,s)).split(" ");return k=n[0],T=n[n.length-1],s+r.length-1}var c=s.length,u=0,h=1,p=2,f=u,g=null,v=null,y="",C=[],b=!1,E=0,S=0,k="{{",T="}}";for(n&&(n=n.split(" "),k=n[0],T=n[1]),E=0;c>E;E++)f==u?r(k,s,E)?(--E,o(),f=h):"\n"==s.charAt(E)?l(b):y+=s.charAt(E):f==h?(E+=k.length-1,v=e.tags[s.charAt(E+1)],g=v?s.charAt(E+1):"_v","="==g?(E=d(s,E),f=u):(v&&E++,f=p),b=E):r(T,s,E)?(C.push({tag:g,n:i(y),otag:k,ctag:T,i:"/"==g?b-k.length:E+T.length}),y="",E+=T.length-1,f=u,"{"==g&&("}}"==T?E++:t(C[C.length-1]))):y+=s.charAt(E);return l(b,!0),C};var E={_t:!0,"\n":!0,$:!0,"/":!0};e.stringify=function(t,i,r){return"{code: function (c,p,i) { "+e.wrapMain(t.code)+" },"+l(t)+"}"};var S=0;e.generate=function(t,i,r){S=0;var s={code:"",subs:{},partials:{}};return e.walk(t,s),r.asString?this.stringify(s,i,r):this.makeTemplate(s,i,r)},e.wrapMain=function(e){return'var t=this;t.b(i=i||"");'+e+"return t.fl();"},e.template=e.Template,e.makeTemplate=function(e,t,i){var r=this.makePartials(e);return r.code=new Function("c","p","i",this.wrapMain(e.code)),new this.template(r,t,this,i)},e.makePartials=function(e){var t,i={subs:{},partials:e.partials,name:e.name};for(t in i.partials)i.partials[t]=this.makePartials(i.partials[t]);for(t in e.subs)i.subs[t]=new Function("c","p","t","i",e.subs[t]);return i},e.codegen={"#":function(t,i){i.code+="if(t.s(t."+c(t.n)+'("'+d(t.n)+'",c,p,1),c,p,0,'+t.i+","+t.end+',"'+t.otag+" "+t.ctag+'")){t.rs(c,p,function(c,p,t){',e.walk(t.nodes,i),i.code+="});c.pop();}"},"^":function(t,i){i.code+="if(!t.s(t."+c(t.n)+'("'+d(t.n)+'",c,p,1),c,p,1,0,0,"")){',e.walk(t.nodes,i),i.code+="};"},">":u,"<":function(t,i){var r={partials:{},code:"",subs:{},inPartial:!0};e.walk(t.nodes,r);var s=i.partials[u(t,i)];s.subs=r.subs,s.partials=r.partials},$:function(t,i){var r={subs:{},code:"",partials:i.partials,prefix:t.n};e.walk(t.nodes,r),i.subs[t.n]=r.code,i.inPartial||(i.code+='t.sub("'+d(t.n)+'",c,p,i);')},"\n":function(e,t){t.code+=p('"\\n"'+(e.last?"":" + i"))},_v:function(e,t){t.code+="t.b(t.v(t."+c(e.n)+'("'+d(e.n)+'",c,p,0)));'},_t:function(e,t){t.code+=p('"'+d(e.text)+'"')},"{":h,"&":h},e.walk=function(t,i){for(var r,s=0,n=t.length;n>s;s++)r=e.codegen[t[s].tag],r&&r(t[s],i);return i},e.parse=function(e,t,i){return i=i||{},s(e,"",[],i.sectionTags||[])},e.cache={},e.cacheKey=function(e,t){return[e,!!t.asString,!!t.disableLambda,t.delimiters,!!t.modelGet].join("||")},e.compile=function(t,i){i=i||{};var r=e.cacheKey(t,i),s=this.cache[r];if(s){var n=s.partials;for(var o in n)delete n[o].instance;return s}return s=this.generate(this.parse(this.scan(t,i.delimiters),t,i),t,i),this.cache[r]=s}}("undefined"!=typeof exports?exports:Hogan),"function"==typeof define&&define.amd&&define("hogan",Hogan),define("stickblock",["core"],function(e){var t={container:window,stickSelector:".js-stickblock",stickContainerSelector:".js-stickblock-control",stickParentClass:"js-stickblock-parent",stickTopClass:"js-sticked-top",stickBottomClass:"js-sticked-bottom",stickAbsoluteClass:"js-sticked-absolute",processedClass:"js-sticked",stickPlaceholder:"js-stick-placeholder",margin:10},i="undefined"!=typeof document&&document,r=i&&i.documentElement,s=function(i){this.settings=e.extend(t,i),this.container={el:null,height:0,offsetTop:0,offsetBottom:0},this.blocks=[],this.window={},this.scroll={curScroll:0,prevScroll:0,scrollDirection:"scrollDown"}};return s.prototype.start=function(){this.loaded||this.initContainer()&&this.initBlocks()&&(this.processAll(),this.loaded=!0)},s.prototype.initContainer=function(){var t=document.querySelector(this.settings.stickContainerSelector);return t?(this.container.el=t,this.container.height=e.getElementHeight(this.container.el),!0):!1},s.prototype.initBlocks=function(){for(var t=document.querySelectorAll(this.settings.stickSelector),i=0,r=t.length;r>i;i++){var s=e.getElementHeight(t[i]);this.blocks.push({el:t[i],parent:null,parentOffsetTop:0,width:0,height:s,contentWidth:0,realOffsetTop:0,offsetTop:0,bottomToTop:0,biggerBlock:!1,tooBig:!1})}return!0},s.prototype.processAll=function(){this.bindWindow(),this.setContainer(),this.reposition()},s.prototype.bindWindow=function(){this.settings.container.addEventListener("touchcancel",this.onScroll.bind(this)),this.settings.container.addEventListener("touchmove",this.onScroll.bind(this)),this.settings.container.addEventListener("touchend",this.onScroll.bind(this)),this.settings.container.addEventListener("scroll",this.onScroll.bind(this)),this.settings.container.addEventListener("resize",this.onResize.bind(this)),this.setWindow()},s.prototype.setWindow=function(){var t=window.innerHeight,i=e.getElementHeight(document.querySelector("#header"));this.window={width:e.getElementWidth(r),height:t,headerOffset:i,availableSpace:t-i-this.settings.margin}},s.prototype.setScroll=function(){this.scroll.curScroll=this.settings.container.pageYOffset||r.scrollTop||r.clientTop||0,this.scroll.scrollDirection=this.scroll.prevScroll>this.scroll.curScroll?"scrollUp":"scrollDown"},s.prototype.setContainer=function(){var t=e.rectangle(this.container.el);this.container.height=e.getElementHeight(this.container.el),this.container.offsetTop=t.t-this.window.headerOffset,this.container.offsetBottom=this.container.height+t.t-this.window.headerOffset},s.prototype.setBlock=function(t){return t.parent=t.el.parentNode,t.parentOffsetTop=e.rectangle(t.parent).t-this.window.headerOffset,t.height=e.getElementHeight(t.el),t.width=e.getElementWidth(t.el),t.contentWidth=e.getElementContentWidth(t.parent),t.realOffsetTop=e.rectangle(t.el).t,t.offsetTop=t.realOffsetTop-this.window.headerOffset,t.bottomToTop=t.realOffsetTop+t.height,t.biggerBlock=t.height>this.window.availableSpace,e.addClass(t.parent,this.settings.stickParentClass),t},s.prototype.reposition=function(){var e=0;this.setScroll();for(var t=0,i=this.blocks.length;i>t;t++){var r=this.setBlock(this.blocks[t]),s=this.stickStatus(r);e+=r.height,r.el.style.width=r.contentWidth+"px",e>=this.container.height?(r.tooBig||(r.tooBig=!0),this.stickReset(r)):(r.tooBig&&(r.tooBig=!1),s.stickAbsolute?r.biggerBlock?this.blockInContainerBottom(r)?this.stickAbsolute(r,0):this.inWindowBottom(r)&&this.stickToBottom(r):this.inWindowTop(r)&&!this.blockInContainerBottom(r)?this.stickToTop(r):this.blockInContainerBottom(r)&&this.stickAbsolute(r,0):s.stickToTop?this.blockInContainerBottom(r)&&this.stickAbsolute(r,0):s.stickToBottom?r.biggerBlock||this.stickToTop(r):this.inWindowTop(r)&&!this.blockInContainerBottom(r)?this.stickToTop(r):this.blockInContainerBottom(r)&&this.stickAbsolute(r,0))}this.scroll.prevScroll=this.scroll.curScroll},s.prototype.update=function(){return this.loaded?(this.setWindow(),this.setContainer(),this.reposition(),!0):!1},s.prototype.destroy=function(){for(var t=0,i=this.blocks.length;i>t;t++)this.stickReset(this.blocks[t]),e.removeClass(this.blocks[t].parent,this.settings.stickParentClass),this.blocks[t].parent.parentNode.style.overflow="";this.blocks=[],this.settings.container.removeEventListener("scroll",this.onScroll),this.settings.container.removeEventListener("resize",this.onResize),this.loaded=!1},s.prototype.onScroll=function(){this.setScroll();for(var e=0,t=this.blocks.length;t>e;e++)this[this.scroll.scrollDirection](this.blocks[e],this.stickStatus(this.blocks[e]));this.scroll.prevScroll=this.scroll.curScroll},s.prototype.onResize=function(){this.update()},s.prototype.scrollUp=function(e,t){e.tooBig||(this.windowInParentTop(e)?this.stickReset(e):t.stickToBottom?this.stickAbsolute(e,1):t.stickAbsolute&&this.inContainerTop(e)&&this.stickToTop(e))},s.prototype.scrollDown=function(e,t){e.tooBig||this.inWindowTop(e)&&(e.biggerBlock?t.stickToTop?this.stickAbsolute(e,2):this.windowInContainerBottomNoMargin(e)?this.stickAbsolute(e,0):this.inWindowBottom(e)&&this.stickToBottom(e):this.blockInContainerBottom(e)?this.stickAbsolute(e,0):this.stickToTop(e))},s.prototype.stickToTop=function(t){e.hasClass(t.el,this.settings.stickTopClass)||(this.stickReset(t),e.addClass(t.el,this.settings.stickTopClass),t.el.style.top=this.window.headerOffset+this.settings.margin+"px",t.el.style.width=t.contentWidth+"px",this.addStickPlaceholder(t))},s.prototype.stickToBottom=function(t){e.hasClass(t.el,this.settings.stickBottomClass)||(this.stickReset(t),e.addClass(t.el,this.settings.stickBottomClass),t.el.style.bottom=this.settings.margin+"px",t.el.style.width=t.contentWidth+"px",this.addStickPlaceholder(t))},s.prototype.stickAbsolute=function(t,i){switch(i){case 0:var r=this.container.height-t.height+(this.container.offsetTop-t.parentOffsetTop);break;case 1:var r=this.scroll.curScroll+this.window.height-t.height-t.parentOffsetTop-this.window.headerOffset-this.settings.margin;break;case 2:var r=this.scroll.curScroll-t.parentOffsetTop+this.settings.margin}this.stickReset(t),e.addClass(t.el,this.settings.stickAbsoluteClass),t.el.style.top=r+"px",t.el.style.width=t.contentWidth+"px",this.addStickPlaceholder(t),this.setBlock(t)},s.prototype.stickReset=function(t){this.removeStickPlaceholder(t),e.removeClass(t.el,this.settings.stickTopClass),e.removeClass(t.el,this.settings.stickAbsoluteClass),e.removeClass(t.el,this.settings.stickBottomClass),t.el.style.top="",t.el.style.bottom="",t.el.style.width="",this.setBlock(t)},s.prototype.stickStatus=function(t){return{stickToTop:e.hasClass(t.el,this.settings.stickTopClass),stickToBottom:e.hasClass(t.el,this.settings.stickBottomClass),stickAbsolute:e.hasClass(t.el,this.settings.stickAbsoluteClass)}},s.prototype.addStickPlaceholder=function(e){var i=document.createElement("div"),r=document.querySelectorAll("."+t.stickPlaceholder)||[];0==r.length&&(i.style.width="100%",i.style.height=e.height+"px",i.setAttribute("class",t.stickPlaceholder),this._after(i,e.el))},s.prototype.removeStickPlaceholder=function(e){var i=document.querySelectorAll("."+t.stickPlaceholder)||[];i.length>0&&i[0].parentElement.removeChild(i[0])},s.prototype._after=function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},s.prototype.blockInContainerBottom=function(e){return this.container.offsetBottom-this.scroll.curScroll-this.settings.margin<e.height},s.prototype.windowInParentTop=function(e){return this.scroll.curScroll<=e.parentOffsetTop-this.settings.margin},s.prototype.windowInContainerBottom=function(){return this.container.offsetBottom-this.scroll.curScroll+this.settings.margin<this.window.availableSpace},s.prototype.windowInContainerBottomNoMargin=function(){return this.container.offsetBottom-this.scroll.curScroll<this.window.availableSpace},s.prototype.inWindowTop=function(e){return this.scroll.curScroll+this.settings.margin>=e.offsetTop},s.prototype.inContainerTop=function(e){return this.scroll.curScroll<=e.offsetTop-this.settings.margin},s.prototype.inWindowBottom=function(e){return this.scroll.curScroll>=e.bottomToTop-this.window.height+this.settings.margin},s}),define("responsive",[],function(){return responsive={xs:{minw:0,maxw:480,media:{matches:!1}},sm:{minw:481,maxw:767,media:{matches:!1}},md:{minw:768,maxw:1024,media:{matches:!1}},xl:{minw:1025,maxw:1440,media:{matches:!1}},small:{minw:0,maxw:1024,media:{matches:!1}},format:null,_started:!1,_formats:{all:["xs","sm","md","xl"],small:["xs","sm","md"]},_listeners:{xs:[],sm:[],md:[],xl:[],small:[]},_start:function(){this._started||(this.xs.media=window.matchMedia("screen and (max-width: "+this.xs.maxw+"px)"),this.sm.media=window.matchMedia("screen and (min-width: "+this.sm.minw+"px) and (max-width:"+this.sm.maxw+"px)"),this.md.media=window.matchMedia("screen and (min-width: "+this.md.minw+"px) and (max-width:"+this.md.maxw+"px)"),this.xl.media=window.matchMedia("screen and (min-width: "+this.xl.minw+"px)"),this.small.media=window.matchMedia("screen and (max-width: "+this.small.maxw+"px)"),this.xs.media.addListener(this.trigger.bind(this,"xs")),this.sm.media.addListener(this.trigger.bind(this,"sm")),this.md.media.addListener(this.trigger.bind(this,"md")),this.xl.media.addListener(this.trigger.bind(this,"xl")),this.small.media.addListener(this.trigger.bind(this,"small")),this._check())},_check:function(){for(var e in this._listeners)if(this[e].media.matches){this.format=e;break}},on:function(e,t){var i;i="all"===e?this._formats[e]:e.split(" ");for(var r=0;r<i.length;r++)this._listeners[i[r]].push(t),this[i[r]].media.matches&&t(i[r])},trigger:function(e){if(this._listeners[e]&&this[e].media.matches){this.format=e;for(var t=0;t<this._listeners[e].length;t++)this._listeners[e][t](e)}},match:function(e){return this[e]&&this[e].media.matches?!0:!1}},responsive._start(),responsive}),define("summaryBox",["pub_sub","constants","core","hogan","stickblock","responsive","loading"],function(e,t,i,r,s,n,o){var a="mod-summaryBox",l="SummaryBox",d="#summaryTemplate",c="#summaryContainer",u=".js-save-and-continue",h=".js-stickblock";_summaryElementViewport=".summaryBox--divider";var p=function(){this.module=document.getElementById(a),this.errorMessageSpan=null,this.saveAndContinueButton=null};return p.prototype.init=function(){var i=this;if(!this.module)throw l+" is not loaded! Check if you have a node with the id: "+a;e.emit(o.MODULE_LOADING,this.module),this.summaryContainer=this.module.querySelector(c),this.saveAndContinueButton=this.module.querySelectorAll(u);var s=this.module.querySelector(d);if(s&&(this.summaryTemplate=s.innerHTML,this.processedTemplate=r.compile(this.summaryTemplate)),this.summaryContainer&&this.updateSummaryInfo(this.module.dataset),this.initStickBlock(),this.loadEvents(),"true"===this.module.dataset.abtest&&window.innerWidth<768&&this.copySummaryBtn(),e.emit(o.MODULE_LOADED,this.module),"true"===this.module.dataset.abtest&&window.innerWidth<768){var i=this;setTimeout(function(){i.fixSummarytoBottom()},250),e.on(t.events.UPDATE_SUMMARY,this.copySummaryBtn.bind(this)),window.addEventListener("scroll",this.fixSummarytoBottom.bind(this)),window.addEventListener("resize",this.fixSummarytoBottom.bind(this)),window.addEventListener("touchmove",this.fixSummarytoBottom.bind(this))}},p.prototype.initStickBlock=function(){var e=this;e.stickblock=new s,n.on("small",function(){e.stickblock.destroy()}),n.on("xl",function(){e.stickblock.start()})},p.prototype.loadDataset=function(e){var t=i.extend({},e);return"string"==typeof e.shippingCost?t.shippingCost=JSON.parse(e.shippingCost):t.shippingCost=e.shippingCost,
t.shippingLabel=e.shippingLabel,t},p.prototype.resetStickBlock=function(){var e=this;setTimeout(function(){e.stickblock.update()},250)},p.prototype.loadEvents=function(){for(var i=0;i<this.saveAndContinueButton.length;i++)this.saveAndContinueButton[i]&&this.saveAndContinueButton[i].addEventListener("click",this.saveAndContinue.bind(this),!0);e.on(t.events.UPDATE_SUMMARY,this.updateSummaryInfo.bind(this)),e.on(t.events.FORM_VALIDATION_FAILED,this.displayErrorMessage.bind(this)),e.on(t.events.SHIPPING_VALIDATION_FAILED,this.displayErrorMessage.bind(this)),e.on(t.events.ACCORDION_CHANGED,this.resetStickBlock.bind(this)),e.on(t.events.PAYMENT_METHOD_CHANGED,this.resetStickBlock.bind(this)),e.on(t.events.EDIT_CLICK_AND_COLLECT,this.resetStickBlock.bind(this)),e.on(t.events.TOGGLE_CREDIT_CARD_LIST_VISIBILITY,this.resetStickBlock.bind(this)),e.on(t.events.ACCORDION_CHANGED,this.fixSummarytoBottom.bind(this)),e.on(t.events.PAYMENT_METHOD_CHANGED,this.fixSummarytoBottom.bind(this)),e.on(t.events.TOGGLE_CREDIT_CARD_LIST_VISIBILITY,this.fixSummarytoBottom.bind(this))},p.prototype.unload=function(){for(var i=0;i<this.saveAndContinueButton.length;i++)this.saveAndContinueButton[i]&&this.saveAndContinueButton[i].removeEventListener("click",this.saveAndContinue);e.off(t.events.UPDATE_SUMMARY,this.updateSummaryInfo),e.off(t.events.FORM_VALIDATION_FAILED,this.displayErrorMessage),e.off(t.events.SHIPPING_VALIDATION_FAILED,this.displayErrorMessage)},p.prototype.saveAndContinue=function(){this.dismissErrorMessage(),e.emit(t.events.CHECKOUT_SAVE_AND_CONTINUE)},p.prototype.updateSummaryInfo=function(e){e&&(this.summaryContainer.innerHTML=this.processedTemplate.render(this.loadDataset(e)))},p.prototype.displayErrorMessage=function(e){if(this.errorMessageSpan)this.setErrorMessageText(this.errorMessageSpan,e),this.errorMessageSpan.classList.remove("hide");else{this.errorMessageSpan=document.createElement("SPAN"),this.errorMessageSpan.classList.add("form-validator_error");for(var t=0;t<this.saveAndContinueButton.length;t++)this.saveAndContinueButton[t]&&(this.setErrorMessageText(this.errorMessageSpan,e),this.saveAndContinueButton[t].parentNode.appendChild(this.errorMessageSpan))}},p.prototype.setErrorMessageText=function(e,t){if(e)if(t)e.innerHTML=t;else for(var i=0;i<this.saveAndContinueButton.length;i++)this.saveAndContinueButton[i]&&this.saveAndContinueButton[i].dataset&&this.saveAndContinueButton[i].dataset.formError&&(e.innerHTML=this.saveAndContinueButton[i].dataset.formError)},p.prototype.dismissErrorMessage=function(){this.errorMessageSpan&&this.errorMessageSpan.classList.add("hide")},p.prototype.copySummaryBtn=function(){this.fixedButton=this.module.querySelector(".js-save-and-continue"),this.copyButtonToFix=this.fixedButton.cloneNode(!0),this.copyButtonToFix.classList.add("summaryContinueButton__fixed"),this.module.querySelector(".checkout-summaryBox-total").appendChild(this.copyButtonToFix),this.copyButtonToFix.addEventListener("click",this.saveAndContinue.bind(this),!0)},p.prototype.isElementInViewport=function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom+102<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},p.prototype.fixSummarytoBottom=function(e){var t=this;this.summaryContainersummaryTitle=this.module.querySelector(_summaryElementViewport),t.isElementInViewport(t.summaryContainersummaryTitle)===!0||t.summaryContainersummaryTitle.getBoundingClientRect().top<=0?(t.module.classList.remove("fixed"),t.module.classList.add("not-fixed")):(t.module.classList.remove("not-fixed"),t.module.classList.add("fixed"))},p.prototype.getLoadingContainer=function(){return this.module.querySelector(h)},p}),function(e){function t(e){var t=e.length,r=i.type(e);return"function"===r||i.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e}if(!e.jQuery){var i=function(e,t){return new i.fn.init(e,t)};i.isWindow=function(e){return null!=e&&e==e.window},i.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?s[o.call(e)]||"object":typeof e},i.isArray=Array.isArray||function(e){return"array"===i.type(e)},i.isPlainObject=function(e){var t;if(!e||"object"!==i.type(e)||e.nodeType||i.isWindow(e))return!1;try{if(e.constructor&&!n.call(e,"constructor")&&!n.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}for(t in e);return void 0===t||n.call(e,t)},i.each=function(e,i,r){var s,n=0,o=e.length,a=t(e);if(r){if(a)for(;o>n&&(s=i.apply(e[n],r),s!==!1);n++);else for(n in e)if(s=i.apply(e[n],r),s===!1)break}else if(a)for(;o>n&&(s=i.call(e[n],n,e[n]),s!==!1);n++);else for(n in e)if(s=i.call(e[n],n,e[n]),s===!1)break;return e},i.data=function(e,t,s){if(void 0===s){var n=e[i.expando],o=n&&r[n];if(void 0===t)return o;if(o&&t in o)return o[t]}else if(void 0!==t){var n=e[i.expando]||(e[i.expando]=++i.uuid);return r[n]=r[n]||{},r[n][t]=s,s}},i.removeData=function(e,t){var s=e[i.expando],n=s&&r[s];n&&i.each(t,function(e,t){delete n[t]})},i.extend=function(){var e,t,r,s,n,o,a=arguments[0]||{},l=1,d=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[l]||{},l++),"object"!=typeof a&&"function"!==i.type(a)&&(a={}),l===d&&(a=this,l--);d>l;l++)if(null!=(n=arguments[l]))for(s in n)e=a[s],r=n[s],a!==r&&(c&&r&&(i.isPlainObject(r)||(t=i.isArray(r)))?(t?(t=!1,o=e&&i.isArray(e)?e:[]):o=e&&i.isPlainObject(e)?e:{},a[s]=i.extend(c,o,r)):void 0!==r&&(a[s]=r));return a},i.queue=function(e,r,s){function n(e,i){var r=i||[];return null!=e&&(t(Object(e))?!function(e,t){for(var i=+t.length,r=0,s=e.length;i>r;)e[s++]=t[r++];if(i!==i)for(;void 0!==t[r];)e[s++]=t[r++];return e.length=s,e}(r,"string"==typeof e?[e]:e):[].push.call(r,e)),r}if(e){r=(r||"fx")+"queue";var o=i.data(e,r);return s?(!o||i.isArray(s)?o=i.data(e,r,n(s)):o.push(s),o):o||[]}},i.dequeue=function(e,t){i.each(e.nodeType?[e]:e,function(e,r){t=t||"fx";var s=i.queue(r,t),n=s.shift();"inprogress"===n&&(n=s.shift()),n&&("fx"===t&&s.unshift("inprogress"),n.call(r,function(){i.dequeue(r,t)}))})},i.fn=i.prototype={init:function(e){if(e.nodeType)return this[0]=e,this;throw new Error("Not a DOM node.")},offset:function(){var t=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:t.top+(e.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:t.left+(e.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function e(){for(var e=this.offsetParent||document;e&&"html"===!e.nodeType.toLowerCase&&"static"===e.style.position;)e=e.offsetParent;return e||document}var t=this[0],e=e.apply(t),r=this.offset(),s=/^(?:body|html)$/i.test(e.nodeName)?{top:0,left:0}:i(e).offset();return r.top-=parseFloat(t.style.marginTop)||0,r.left-=parseFloat(t.style.marginLeft)||0,e.style&&(s.top+=parseFloat(e.style.borderTopWidth)||0,s.left+=parseFloat(e.style.borderLeftWidth)||0),{top:r.top-s.top,left:r.left-s.left}}};var r={};i.expando="velocity"+(new Date).getTime(),i.uuid=0;for(var s={},n=s.hasOwnProperty,o=s.toString,a="Boolean Number String Function Array Date RegExp Object Error".split(" "),l=0;l<a.length;l++)s["[object "+a[l]+"]"]=a[l].toLowerCase();i.fn.init.prototype=i.fn,e.Velocity={Utilities:i}}}(window),function(e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e():"function"==typeof define&&define.amd?define("velocity",e):e()}(function(){return function(e,t,i,r){function s(e){for(var t=-1,i=e?e.length:0,r=[];++t<i;){var s=e[t];s&&r.push(s)}return r}function n(e){return f.isWrapped(e)?e=[].slice.call(e):f.isNode(e)&&(e=[e]),e}function o(e){var t=h.data(e,"velocity");return null===t?r:t}function a(e){return function(t){return Math.round(t*e)*(1/e)}}function l(e,i,r,s){function n(e,t){return 1-3*t+3*e}function o(e,t){return 3*t-6*e}function a(e){return 3*e}function l(e,t,i){return((n(t,i)*e+o(t,i))*e+a(t))*e}function d(e,t,i){return 3*n(t,i)*e*e+2*o(t,i)*e+a(t)}function c(t,i){for(var s=0;f>s;++s){var n=d(i,e,r);if(0===n)return i;var o=l(i,e,r)-t;i-=o/n}return i}function u(){for(var t=0;C>t;++t)k[t]=l(t*b,e,r)}function h(t,i,s){var n,o,a=0;do o=i+(s-i)/2,n=l(o,e,r)-t,n>0?s=o:i=o;while(Math.abs(n)>v&&++a<y);return o}function p(t){for(var i=0,s=1,n=C-1;s!=n&&k[s]<=t;++s)i+=b;--s;var o=(t-k[s])/(k[s+1]-k[s]),a=i+o*b,l=d(a,e,r);return l>=g?c(t,a):0==l?a:h(t,i,i+b)}function m(){T=!0,(e!=i||r!=s)&&u()}var f=4,g=.001,v=1e-7,y=10,C=11,b=1/(C-1),E="Float32Array"in t;if(4!==arguments.length)return!1;for(var S=0;4>S;++S)if("number"!=typeof arguments[S]||isNaN(arguments[S])||!isFinite(arguments[S]))return!1;e=Math.min(e,1),r=Math.min(r,1),e=Math.max(e,0),r=Math.max(r,0);var k=E?new Float32Array(C):new Array(C),T=!1,A=function(t){return T||m(),e===i&&r===s?t:0===t?0:1===t?1:l(p(t),i,s)};A.getControlPoints=function(){return[{x:e,y:i},{x:r,y:s}]};var w="generateBezier("+[e,i,r,s]+")";return A.toString=function(){return w},A}function d(e,t){var i=e;return f.isString(e)?C.Easings[e]||(i=!1):i=f.isArray(e)&&1===e.length?a.apply(null,e):f.isArray(e)&&2===e.length?b.apply(null,e.concat([t])):f.isArray(e)&&4===e.length?l.apply(null,e):!1,i===!1&&(i=C.Easings[C.defaults.easing]?C.defaults.easing:y),i}function c(e){if(e){var t=(new Date).getTime(),i=C.State.calls.length;i>1e4&&(C.State.calls=s(C.State.calls));for(var n=0;i>n;n++)if(C.State.calls[n]){var a=C.State.calls[n],l=a[0],d=a[2],p=a[3],m=!!p,g=null;p||(p=C.State.calls[n][3]=t-16);for(var v=Math.min((t-p)/d.duration,1),y=0,b=l.length;b>y;y++){var S=l[y],T=S.element;if(o(T)){var A=!1;if(d.display!==r&&null!==d.display&&"none"!==d.display){if("flex"===d.display){var w=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];h.each(w,function(e,t){E.setPropertyValue(T,"display",t)})}E.setPropertyValue(T,"display",d.display)}d.visibility!==r&&"hidden"!==d.visibility&&E.setPropertyValue(T,"visibility",d.visibility);for(var I in S)if("element"!==I){var x,P=S[I],L=f.isString(P.easing)?C.Easings[P.easing]:P.easing;if(1===v)x=P.endValue;else{var M=P.endValue-P.startValue;if(x=P.startValue+M*L(v,d,M),!m&&x===P.currentValue)continue}if(P.currentValue=x,"tween"===I)g=x;else{if(E.Hooks.registered[I]){var _=E.Hooks.getRoot(I),O=o(T).rootPropertyValueCache[_];O&&(P.rootPropertyValue=O)}var B=E.setPropertyValue(T,I,P.currentValue+(0===parseFloat(x)?"":P.unitType),P.rootPropertyValue,P.scrollData);E.Hooks.registered[I]&&(E.Normalizations.registered[_]?o(T).rootPropertyValueCache[_]=E.Normalizations.registered[_]("extract",null,B[1]):o(T).rootPropertyValueCache[_]=B[1]),"transform"===B[0]&&(A=!0)}}d.mobileHA&&o(T).transformCache.translate3d===r&&(o(T).transformCache.translate3d="(0px, 0px, 0px)",A=!0),A&&E.flushTransformCache(T)}}d.display!==r&&"none"!==d.display&&(C.State.calls[n][2].display=!1),d.visibility!==r&&"hidden"!==d.visibility&&(C.State.calls[n][2].visibility=!1),d.progress&&d.progress.call(a[1],a[1],v,Math.max(0,p+d.duration-t),p,g),1===v&&u(n)}}C.State.isTicking&&k(c)}function u(e,t){if(!C.State.calls[e])return!1;for(var i=C.State.calls[e][0],s=C.State.calls[e][1],n=C.State.calls[e][2],a=C.State.calls[e][4],l=!1,d=0,c=i.length;c>d;d++){var u=i[d].element;if(t||n.loop||("none"===n.display&&E.setPropertyValue(u,"display",n.display),"hidden"===n.visibility&&E.setPropertyValue(u,"visibility",n.visibility)),n.loop!==!0&&(h.queue(u)[1]===r||!/\.velocityQueueEntryFlag/i.test(h.queue(u)[1]))&&o(u)){o(u).isAnimating=!1,o(u).rootPropertyValueCache={};var p=!1;h.each(E.Lists.transforms3D,function(e,t){var i=/^scale/.test(t)?1:0,s=o(u).transformCache[t];o(u).transformCache[t]!==r&&new RegExp("^\\("+i+"[^.]").test(s)&&(p=!0,delete o(u).transformCache[t])}),n.mobileHA&&(p=!0,delete o(u).transformCache.translate3d),p&&E.flushTransformCache(u),E.Values.removeClass(u,"velocity-animating")}if(!t&&n.complete&&!n.loop&&d===c-1)try{n.complete.call(s,s)}catch(m){setTimeout(function(){throw m},1)}a&&n.loop!==!0&&a(s),o(u)&&n.loop===!0&&!t&&(h.each(o(u).tweensContainer,function(e,t){/^rotate/.test(e)&&360===parseFloat(t.endValue)&&(t.endValue=0,t.startValue=360),/^backgroundPosition/.test(e)&&100===parseFloat(t.endValue)&&"%"===t.unitType&&(t.endValue=0,t.startValue=100)}),C(u,"reverse",{loop:!0,delay:n.delay})),n.queue!==!1&&h.dequeue(u,n.queue)}C.State.calls[e]=!1;for(var f=0,g=C.State.calls.length;g>f;f++)if(C.State.calls[f]!==!1){l=!0;break}l===!1&&(C.State.isTicking=!1,delete C.State.calls,C.State.calls=[])}var h,p=function(){if(i.documentMode)return i.documentMode;for(var e=7;e>4;e--){var t=i.createElement("div");if(t.innerHTML="<!--[if IE "+e+"]><span></span><![endif]-->",t.getElementsByTagName("span").length)return t=null,e}return r}(),m=function(){var e=0;return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(t){var i,r=(new Date).getTime();return i=Math.max(0,16-(r-e)),e=r+i,setTimeout(function(){t(r+i)},i)}}(),f={isString:function(e){return"string"==typeof e},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isNode:function(e){return e&&e.nodeType},isNodeList:function(e){return"object"==typeof e&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(e))&&e.length!==r&&(0===e.length||"object"==typeof e[0]&&e[0].nodeType>0)},isWrapped:function(e){return e&&(e.jquery||t.Zepto&&t.Zepto.zepto.isZ(e))},isSVG:function(e){return t.SVGElement&&e instanceof t.SVGElement},isEmptyObject:function(e){for(var t in e)return!1;return!0}},g=!1;if(e.fn&&e.fn.jquery?(h=e,g=!0):h=t.Velocity.Utilities,8>=p&&!g)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(7>=p)return void(jQuery.fn.velocity=jQuery.fn.animate);var v=400,y="swing",C={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:t.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:i.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:h,Redirects:{},Easings:{},Promise:t.Promise,defaults:{queue:"",duration:v,easing:y,begin:r,complete:r,progress:r,display:r,visibility:r,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(e){h.data(e,"velocity",{isSVG:f.isSVG(e),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:2,patch:2},debug:!1};t.pageYOffset!==r?(C.State.scrollAnchor=t,C.State.scrollPropertyLeft="pageXOffset",C.State.scrollPropertyTop="pageYOffset"):(C.State.scrollAnchor=i.documentElement||i.body.parentNode||i.body,C.State.scrollPropertyLeft="scrollLeft",C.State.scrollPropertyTop="scrollTop");var b=function(){function e(e){return-e.tension*e.x-e.friction*e.v}function t(t,i,r){var s={x:t.x+r.dx*i,v:t.v+r.dv*i,tension:t.tension,friction:t.friction};return{dx:s.v,dv:e(s)}}function i(i,r){var s={dx:i.v,dv:e(i)},n=t(i,.5*r,s),o=t(i,.5*r,n),a=t(i,r,o),l=1/6*(s.dx+2*(n.dx+o.dx)+a.dx),d=1/6*(s.dv+2*(n.dv+o.dv)+a.dv);return i.x=i.x+l*r,i.v=i.v+d*r,i}return function r(e,t,s){var n,o,a,l={x:-1,v:0,tension:null,friction:null},d=[0],c=0,u=1e-4,h=.016;for(e=parseFloat(e)||500,t=parseFloat(t)||20,s=s||null,l.tension=e,l.friction=t,n=null!==s,n?(c=r(e,t),o=c/s*h):o=h;;)if(a=i(a||l,o),d.push(1+a.x),c+=16,!(Math.abs(a.x)>u&&Math.abs(a.v)>u))break;return n?function(e){return d[e*(d.length-1)|0]}:c}}();C.Easings={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)}},h.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(e,t){C.Easings[t[0]]=l.apply(null,t[1])});var E=C.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var e=0;e<E.Lists.colors.length;e++){var t="color"===E.Lists.colors[e]?"0 0 0 1":"255 255 255 1";E.Hooks.templates[E.Lists.colors[e]]=["Red Green Blue Alpha",t]}var i,r,s;if(p)for(i in E.Hooks.templates){r=E.Hooks.templates[i],s=r[0].split(" ");var n=r[1].match(E.RegEx.valueSplit);"Color"===s[0]&&(s.push(s.shift()),n.push(n.shift()),E.Hooks.templates[i]=[s.join(" "),n.join(" ")])}for(i in E.Hooks.templates){r=E.Hooks.templates[i],s=r[0].split(" ");for(var e in s){var o=i+s[e],a=e;E.Hooks.registered[o]=[i,a]}}},getRoot:function(e){var t=E.Hooks.registered[e];return t?t[0]:e},cleanRootPropertyValue:function(e,t){return E.RegEx.valueUnwrap.test(t)&&(t=t.match(E.RegEx.valueUnwrap)[1]),E.Values.isCSSNullValue(t)&&(t=E.Hooks.templates[e][1]),t},extractValue:function(e,t){var i=E.Hooks.registered[e];if(i){var r=i[0],s=i[1];return t=E.Hooks.cleanRootPropertyValue(r,t),t.toString().match(E.RegEx.valueSplit)[s]}return t},injectValue:function(e,t,i){var r=E.Hooks.registered[e];if(r){var s,n,o=r[0],a=r[1];return i=E.Hooks.cleanRootPropertyValue(o,i),s=i.toString().match(E.RegEx.valueSplit),s[a]=t,n=s.join(" ")}return i}},Normalizations:{registered:{clip:function(e,t,i){switch(e){case"name":return"clip";case"extract":var r;return E.RegEx.wrappedValueAlreadyExtracted.test(i)?r=i:(r=i.toString().match(E.RegEx.valueUnwrap),r=r?r[1].replace(/,(\s+)?/g," "):i),r;case"inject":return"rect("+i+")"}},blur:function(e,t,i){switch(e){case"name":return C.State.isFirefox?"filter":"-webkit-filter";case"extract":var r=parseFloat(i);if(!r&&0!==r){var s=i.toString().match(/blur\(([0-9]+[A-z]+)\)/i);r=s?s[1]:0}return r;case"inject":return parseFloat(i)?"blur("+i+")":"none"}},opacity:function(e,t,i){if(8>=p)switch(e){case"name":return"filter";case"extract":var r=i.toString().match(/alpha\(opacity=(.*)\)/i);return i=r?r[1]/100:1;case"inject":return t.style.zoom=1,parseFloat(i)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(i),10)+")"}else switch(e){case"name":return"opacity";case"extract":return i;case"inject":return i}}},register:function(){9>=p||C.State.isGingerbread||(E.Lists.transformsBase=E.Lists.transformsBase.concat(E.Lists.transforms3D));for(var e=0;e<E.Lists.transformsBase.length;e++)!function(){var t=E.Lists.transformsBase[e];E.Normalizations.registered[t]=function(e,i,s){switch(e){case"name":return"transform";case"extract":return o(i)===r||o(i).transformCache[t]===r?/^scale/i.test(t)?1:0:o(i).transformCache[t].replace(/[()]/g,"");case"inject":var n=!1;switch(t.substr(0,t.length-1)){case"translate":n=!/(%|px|em|rem|vw|vh|\d)$/i.test(s);break;case"scal":case"scale":C.State.isAndroid&&o(i).transformCache[t]===r&&1>s&&(s=1),n=!/(\d)$/i.test(s);break;case"skew":n=!/(deg|\d)$/i.test(s);break;case"rotate":n=!/(deg|\d)$/i.test(s)}return n||(o(i).transformCache[t]="("+s+")"),o(i).transformCache[t]}}}();for(var e=0;e<E.Lists.colors.length;e++)!function(){var t=E.Lists.colors[e];E.Normalizations.registered[t]=function(e,i,s){switch(e){case"name":return t;case"extract":var n;if(E.RegEx.wrappedValueAlreadyExtracted.test(s))n=s;else{var o,a={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};/^[A-z]+$/i.test(s)?o=a[s]!==r?a[s]:a.black:E.RegEx.isHex.test(s)?o="rgb("+E.Values.hexToRgb(s).join(" ")+")":/^rgba?\(/i.test(s)||(o=a.black),n=(o||s).toString().match(E.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return 8>=p||3!==n.split(" ").length||(n+=" 1"),n;case"inject":return 8>=p?4===s.split(" ").length&&(s=s.split(/\s+/).slice(0,3).join(" ")):3===s.split(" ").length&&(s+=" 1"),(8>=p?"rgb":"rgba")+"("+s.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")"}}}()}},Names:{camelCase:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},SVGAttribute:function(e){var t="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(p||C.State.isAndroid&&!C.State.isChrome)&&(t+="|transform"),new RegExp("^("+t+")$","i").test(e)},prefixCheck:function(e){if(C.State.prefixMatches[e])return[C.State.prefixMatches[e],!0];for(var t=["","Webkit","Moz","ms","O"],i=0,r=t.length;r>i;i++){var s;if(s=0===i?e:t[i]+e.replace(/^\w/,function(e){return e.toUpperCase()}),f.isString(C.State.prefixElement.style[s]))return C.State.prefixMatches[e]=s,[s,!0]}return[e,!1]}},Values:{hexToRgb:function(e){var t,i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;return e=e.replace(i,function(e,t,i,r){return t+t+i+i+r+r}),t=r.exec(e),t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[0,0,0]},isCSSNullValue:function(e){return 0==e||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(e)},getUnitType:function(e){return/^(rotate|skew)/i.test(e)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(e)?"":"px"},getDisplayType:function(e){var t=e&&e.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(t)?"inline":/^(li)$/i.test(t)?"list-item":/^(tr)$/i.test(t)?"table-row":/^(table)$/i.test(t)?"table":/^(tbody)$/i.test(t)?"table-row-group":"block"},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=(e.className.length?" ":"")+t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.toString().replace(new RegExp("(^|\\s)"+t.split(" ").join("|")+"(\\s|$)","gi")," ")}},getPropertyValue:function(e,i,s,n){function a(e,i){function s(){d&&E.setPropertyValue(e,"display","none")}var l=0;if(8>=p)l=h.css(e,i);else{var d=!1;if(/^(width|height)$/.test(i)&&0===E.getPropertyValue(e,"display")&&(d=!0,E.setPropertyValue(e,"display",E.Values.getDisplayType(e))),!n){if("height"===i&&"border-box"!==E.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var c=e.offsetHeight-(parseFloat(E.getPropertyValue(e,"borderTopWidth"))||0)-(parseFloat(E.getPropertyValue(e,"borderBottomWidth"))||0)-(parseFloat(E.getPropertyValue(e,"paddingTop"))||0)-(parseFloat(E.getPropertyValue(e,"paddingBottom"))||0);return s(),c}if("width"===i&&"border-box"!==E.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var u=e.offsetWidth-(parseFloat(E.getPropertyValue(e,"borderLeftWidth"))||0)-(parseFloat(E.getPropertyValue(e,"borderRightWidth"))||0)-(parseFloat(E.getPropertyValue(e,"paddingLeft"))||0)-(parseFloat(E.getPropertyValue(e,"paddingRight"))||0);return s(),u}}var m;m=o(e)===r?t.getComputedStyle(e,null):o(e).computedStyle?o(e).computedStyle:o(e).computedStyle=t.getComputedStyle(e,null),"borderColor"===i&&(i="borderTopColor"),l=9===p&&"filter"===i?m.getPropertyValue(i):m[i],(""===l||null===l)&&(l=e.style[i]),s()}if("auto"===l&&/^(top|right|bottom|left)$/i.test(i)){var f=a(e,"position");("fixed"===f||"absolute"===f&&/top|left/i.test(i))&&(l=h(e).position()[i]+"px")}return l}var l;if(E.Hooks.registered[i]){var d=i,c=E.Hooks.getRoot(d);s===r&&(s=E.getPropertyValue(e,E.Names.prefixCheck(c)[0])),E.Normalizations.registered[c]&&(s=E.Normalizations.registered[c]("extract",e,s)),l=E.Hooks.extractValue(d,s)}else if(E.Normalizations.registered[i]){var u,m;u=E.Normalizations.registered[i]("name",e),"transform"!==u&&(m=a(e,E.Names.prefixCheck(u)[0]),E.Values.isCSSNullValue(m)&&E.Hooks.templates[i]&&(m=E.Hooks.templates[i][1])),l=E.Normalizations.registered[i]("extract",e,m)}if(!/^[\d-]/.test(l))if(o(e)&&o(e).isSVG&&E.Names.SVGAttribute(i))if(/^(height|width)$/i.test(i))try{l=e.getBBox()[i]}catch(f){l=0}else l=e.getAttribute(i);else l=a(e,E.Names.prefixCheck(i)[0]);return E.Values.isCSSNullValue(l)&&(l=0),C.debug>=2&&console.log("Get "+i+": "+l),l},setPropertyValue:function(e,i,r,s,n){var a=i;if("scroll"===i)n.container?n.container["scroll"+n.direction]=r:"Left"===n.direction?t.scrollTo(r,n.alternateValue):t.scrollTo(n.alternateValue,r);else if(E.Normalizations.registered[i]&&"transform"===E.Normalizations.registered[i]("name",e))E.Normalizations.registered[i]("inject",e,r),a="transform",r=o(e).transformCache[i];else{if(E.Hooks.registered[i]){var l=i,d=E.Hooks.getRoot(i);s=s||E.getPropertyValue(e,d),r=E.Hooks.injectValue(l,r,s),i=d}if(E.Normalizations.registered[i]&&(r=E.Normalizations.registered[i]("inject",e,r),i=E.Normalizations.registered[i]("name",e)),a=E.Names.prefixCheck(i)[0],8>=p)try{e.style[a]=r}catch(c){C.debug&&console.log("Browser does not support ["+r+"] for ["+a+"]")}else o(e)&&o(e).isSVG&&E.Names.SVGAttribute(i)?e.setAttribute(i,r):e.style[a]=r;C.debug>=2&&console.log("Set "+i+" ("+a+"): "+r)}return[a,r]},flushTransformCache:function(e){function t(t){return parseFloat(E.getPropertyValue(e,t))}var i="";if((p||C.State.isAndroid&&!C.State.isChrome)&&o(e).isSVG){var r={translate:[t("translateX"),t("translateY")],skewX:[t("skewX")],skewY:[t("skewY")],scale:1!==t("scale")?[t("scale"),t("scale")]:[t("scaleX"),t("scaleY")],rotate:[t("rotateZ"),0,0]};h.each(o(e).transformCache,function(e){/^translate/i.test(e)?e="translate":/^scale/i.test(e)?e="scale":/^rotate/i.test(e)&&(e="rotate"),r[e]&&(i+=e+"("+r[e].join(" ")+") ",delete r[e])})}else{var s,n;h.each(o(e).transformCache,function(t){return s=o(e).transformCache[t],"transformPerspective"===t?(n=s,!0):(9===p&&"rotateZ"===t&&(t="rotate"),void(i+=t+s+" "))}),n&&(i="perspective"+n+" "+i)}E.setPropertyValue(e,"transform",i)}};E.Hooks.register(),E.Normalizations.register(),C.hook=function(e,t,i){var s=r;return e=n(e),h.each(e,function(e,n){if(o(n)===r&&C.init(n),i===r)s===r&&(s=C.CSS.getPropertyValue(n,t));else{var a=C.CSS.setPropertyValue(n,t,i);"transform"===a[0]&&C.CSS.flushTransformCache(n),s=a}}),s};var S=function(){function e(){return a?I.promise||null:l}function s(){function e(e){function u(e,t){var i=r,s=r,o=r;return f.isArray(e)?(i=e[0],!f.isArray(e[1])&&/^[\d-]/.test(e[1])||f.isFunction(e[1])||E.RegEx.isHex.test(e[1])?o=e[1]:(f.isString(e[1])&&!E.RegEx.isHex.test(e[1])||f.isArray(e[1]))&&(s=t?e[1]:d(e[1],a.duration),e[2]!==r&&(o=e[2]))):i=e,t||(s=s||a.easing),f.isFunction(i)&&(i=i.call(n,T,k)),f.isFunction(o)&&(o=o.call(n,T,k)),[i||0,s,o]}function p(e,t){var i,r;return r=(t||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(e){return i=e,""}),i||(i=E.Values.getUnitType(e)),[r,i]}function v(){var e={myParent:n.parentNode||i.body,position:E.getPropertyValue(n,"position"),fontSize:E.getPropertyValue(n,"fontSize")},r=e.position===B.lastPosition&&e.myParent===B.lastParent,s=e.fontSize===B.lastFontSize;B.lastParent=e.myParent,B.lastPosition=e.position,B.lastFontSize=e.fontSize;var a=100,l={};if(s&&r)l.emToPx=B.lastEmToPx,l.percentToPxWidth=B.lastPercentToPxWidth,l.percentToPxHeight=B.lastPercentToPxHeight;else{var d=o(n).isSVG?i.createElementNS("http://www.w3.org/2000/svg","rect"):i.createElement("div");C.init(d),e.myParent.appendChild(d),h.each(["overflow","overflowX","overflowY"],function(e,t){C.CSS.setPropertyValue(d,t,"hidden")}),C.CSS.setPropertyValue(d,"position",e.position),C.CSS.setPropertyValue(d,"fontSize",e.fontSize),C.CSS.setPropertyValue(d,"boxSizing","content-box"),h.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(e,t){C.CSS.setPropertyValue(d,t,a+"%")}),C.CSS.setPropertyValue(d,"paddingLeft",a+"em"),l.percentToPxWidth=B.lastPercentToPxWidth=(parseFloat(E.getPropertyValue(d,"width",null,!0))||1)/a,l.percentToPxHeight=B.lastPercentToPxHeight=(parseFloat(E.getPropertyValue(d,"height",null,!0))||1)/a,l.emToPx=B.lastEmToPx=(parseFloat(E.getPropertyValue(d,"paddingLeft"))||1)/a,e.myParent.removeChild(d)}return null===B.remToPx&&(B.remToPx=parseFloat(E.getPropertyValue(i.body,"fontSize"))||16),null===B.vwToPx&&(B.vwToPx=parseFloat(t.innerWidth)/100,B.vhToPx=parseFloat(t.innerHeight)/100),l.remToPx=B.remToPx,l.vwToPx=B.vwToPx,l.vhToPx=B.vhToPx,C.debug>=1&&console.log("Unit ratios: "+JSON.stringify(l),n),l}if(a.begin&&0===T)try{a.begin.call(m,m)}catch(b){setTimeout(function(){throw b},1)}if("scroll"===x){var S,A,w,P=/^x$/i.test(a.axis)?"Left":"Top",L=parseFloat(a.offset)||0;a.container?f.isWrapped(a.container)||f.isNode(a.container)?(a.container=a.container[0]||a.container,S=a.container["scroll"+P],w=S+h(n).position()[P.toLowerCase()]+L):a.container=null:(S=C.State.scrollAnchor[C.State["scrollProperty"+P]],A=C.State.scrollAnchor[C.State["scrollProperty"+("Left"===P?"Top":"Left")]],w=h(n).offset()[P.toLowerCase()]+L),l={scroll:{rootPropertyValue:!1,startValue:S,currentValue:S,endValue:w,unitType:"",easing:a.easing,scrollData:{container:a.container,direction:P,alternateValue:A}},element:n},C.debug&&console.log("tweensContainer (scroll): ",l.scroll,n)}else if("reverse"===x){if(!o(n).tweensContainer)return void h.dequeue(n,a.queue);"none"===o(n).opts.display&&(o(n).opts.display="auto"),"hidden"===o(n).opts.visibility&&(o(n).opts.visibility="visible"),o(n).opts.loop=!1,o(n).opts.begin=null,o(n).opts.complete=null,y.easing||delete a.easing,y.duration||delete a.duration,a=h.extend({},o(n).opts,a);var M=h.extend(!0,{},o(n).tweensContainer);for(var _ in M)if("element"!==_){var O=M[_].startValue;M[_].startValue=M[_].currentValue=M[_].endValue,M[_].endValue=O,f.isEmptyObject(y)||(M[_].easing=a.easing),C.debug&&console.log("reverse tweensContainer ("+_+"): "+JSON.stringify(M[_]),n)}l=M}else if("start"===x){var M;o(n).tweensContainer&&o(n).isAnimating===!0&&(M=o(n).tweensContainer),h.each(g,function(e,t){if(RegExp("^"+E.Lists.colors.join("$|^")+"$").test(e)){var i=u(t,!0),s=i[0],n=i[1],o=i[2];if(E.RegEx.isHex.test(s)){for(var a=["Red","Green","Blue"],l=E.Values.hexToRgb(s),d=o?E.Values.hexToRgb(o):r,c=0;c<a.length;c++){var h=[l[c]];n&&h.push(n),d!==r&&h.push(d[c]),g[e+a[c]]=h}delete g[e]}}});for(var V in g){var F=u(g[V]),R=F[0],N=F[1],H=F[2];V=E.Names.camelCase(V);var j=E.Hooks.getRoot(V),q=!1;if(o(n).isSVG||"tween"===j||E.Names.prefixCheck(j)[1]!==!1||E.Normalizations.registered[j]!==r){(a.display!==r&&null!==a.display&&"none"!==a.display||a.visibility!==r&&"hidden"!==a.visibility)&&/opacity|filter/.test(V)&&!H&&0!==R&&(H=0),a._cacheValues&&M&&M[V]?(H===r&&(H=M[V].endValue+M[V].unitType),q=o(n).rootPropertyValueCache[j]):E.Hooks.registered[V]?H===r?(q=E.getPropertyValue(n,j),H=E.getPropertyValue(n,V,q)):q=E.Hooks.templates[j][1]:H===r&&(H=E.getPropertyValue(n,V));var U,W,z,Y=!1;if(U=p(V,H),H=U[0],z=U[1],U=p(V,R),R=U[0].replace(/^([+-\/*])=/,function(e,t){return Y=t,""}),W=U[1],H=parseFloat(H)||0,R=parseFloat(R)||0,"%"===W&&(/^(fontSize|lineHeight)$/.test(V)?(R/=100,W="em"):/^scale/.test(V)?(R/=100,W=""):/(Red|Green|Blue)$/i.test(V)&&(R=R/100*255,W="")),/[\/*]/.test(Y))W=z;else if(z!==W&&0!==H)if(0===R)W=z;else{
s=s||v();var G=/margin|padding|left|right|width|text|word|letter/i.test(V)||/X$/.test(V)||"x"===V?"x":"y";switch(z){case"%":H*="x"===G?s.percentToPxWidth:s.percentToPxHeight;break;case"px":break;default:H*=s[z+"ToPx"]}switch(W){case"%":H*=1/("x"===G?s.percentToPxWidth:s.percentToPxHeight);break;case"px":break;default:H*=1/s[W+"ToPx"]}}switch(Y){case"+":R=H+R;break;case"-":R=H-R;break;case"*":R=H*R;break;case"/":R=H/R}l[V]={rootPropertyValue:q,startValue:H,currentValue:H,endValue:R,unitType:W,easing:N},C.debug&&console.log("tweensContainer ("+V+"): "+JSON.stringify(l[V]),n)}else C.debug&&console.log("Skipping ["+j+"] due to a lack of browser support.")}l.element=n}l.element&&(E.Values.addClass(n,"velocity-animating"),D.push(l),""===a.queue&&(o(n).tweensContainer=l,o(n).opts=a),o(n).isAnimating=!0,T===k-1?(C.State.calls.push([D,m,a,null,I.resolver]),C.State.isTicking===!1&&(C.State.isTicking=!0,c())):T++)}var s,n=this,a=h.extend({},C.defaults,y),l={};switch(o(n)===r&&C.init(n),parseFloat(a.delay)&&a.queue!==!1&&h.queue(n,a.queue,function(e){C.velocityQueueEntryFlag=!0,o(n).delayTimer={setTimeout:setTimeout(e,parseFloat(a.delay)),next:e}}),a.duration.toString().toLowerCase()){case"fast":a.duration=200;break;case"normal":a.duration=v;break;case"slow":a.duration=600;break;default:a.duration=parseFloat(a.duration)||1}C.mock!==!1&&(C.mock===!0?a.duration=a.delay=1:(a.duration*=parseFloat(C.mock)||1,a.delay*=parseFloat(C.mock)||1)),a.easing=d(a.easing,a.duration),a.begin&&!f.isFunction(a.begin)&&(a.begin=null),a.progress&&!f.isFunction(a.progress)&&(a.progress=null),a.complete&&!f.isFunction(a.complete)&&(a.complete=null),a.display!==r&&null!==a.display&&(a.display=a.display.toString().toLowerCase(),"auto"===a.display&&(a.display=C.CSS.Values.getDisplayType(n))),a.visibility!==r&&null!==a.visibility&&(a.visibility=a.visibility.toString().toLowerCase()),a.mobileHA=a.mobileHA&&C.State.isMobile&&!C.State.isGingerbread,a.queue===!1?a.delay?setTimeout(e,a.delay):e():h.queue(n,a.queue,function(t,i){return i===!0?(I.promise&&I.resolver(m),!0):(C.velocityQueueEntryFlag=!0,void e(t))}),""!==a.queue&&"fx"!==a.queue||"inprogress"===h.queue(n)[0]||h.dequeue(n)}var a,l,p,m,g,y,b=arguments[0]&&(arguments[0].p||h.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||f.isString(arguments[0].properties));if(f.isWrapped(this)?(a=!1,p=0,m=this,l=this):(a=!0,p=1,m=b?arguments[0].elements||arguments[0].e:arguments[0]),m=n(m)){b?(g=arguments[0].properties||arguments[0].p,y=arguments[0].options||arguments[0].o):(g=arguments[p],y=arguments[p+1]);var k=m.length,T=0;if(!/^(stop|finish|finishAll)$/i.test(g)&&!h.isPlainObject(y)){var A=p+1;y={};for(var w=A;w<arguments.length;w++)f.isArray(arguments[w])||!/^(fast|normal|slow)$/i.test(arguments[w])&&!/^\d/.test(arguments[w])?f.isString(arguments[w])||f.isArray(arguments[w])?y.easing=arguments[w]:f.isFunction(arguments[w])&&(y.complete=arguments[w]):y.duration=arguments[w]}var I={promise:null,resolver:null,rejecter:null};a&&C.Promise&&(I.promise=new C.Promise(function(e,t){I.resolver=e,I.rejecter=t}));var x;switch(g){case"scroll":x="scroll";break;case"reverse":x="reverse";break;case"finish":case"finishAll":case"stop":h.each(m,function(e,t){o(t)&&o(t).delayTimer&&(clearTimeout(o(t).delayTimer.setTimeout),o(t).delayTimer.next&&o(t).delayTimer.next(),delete o(t).delayTimer),"finishAll"!==g||y!==!0&&!f.isString(y)||(h.each(h.queue(t,f.isString(y)?y:""),function(e,t){f.isFunction(t)&&t()}),h.queue(t,f.isString(y)?y:"",[]))});var P=[];return h.each(C.State.calls,function(e,t){t&&h.each(t[1],function(i,s){var n=y===r?"":y;return n===!0||t[2].queue===n||y===r&&t[2].queue===!1?void h.each(m,function(i,r){r===s&&((y===!0||f.isString(y))&&(h.each(h.queue(r,f.isString(y)?y:""),function(e,t){f.isFunction(t)&&t(null,!0)}),h.queue(r,f.isString(y)?y:"",[])),"stop"===g?(o(r)&&o(r).tweensContainer&&n!==!1&&h.each(o(r).tweensContainer,function(e,t){t.endValue=t.currentValue}),P.push(e)):("finish"===g||"finishAll"===g)&&(t[2].duration=1))}):!0})}),"stop"===g&&(h.each(P,function(e,t){u(t,!0)}),I.promise&&I.resolver(m)),e();default:if(!h.isPlainObject(g)||f.isEmptyObject(g)){if(f.isString(g)&&C.Redirects[g]){var L=h.extend({},y),M=L.duration,_=L.delay||0;return L.backwards===!0&&(m=h.extend(!0,[],m).reverse()),h.each(m,function(e,t){parseFloat(L.stagger)?L.delay=_+parseFloat(L.stagger)*e:f.isFunction(L.stagger)&&(L.delay=_+L.stagger.call(t,e,k)),L.drag&&(L.duration=parseFloat(M)||(/^(callout|transition)/.test(g)?1e3:v),L.duration=Math.max(L.duration*(L.backwards?1-e/k:(e+1)/k),.75*L.duration,200)),C.Redirects[g].call(t,t,L||{},e,k,m,I.promise?I:r)}),e()}var O="Velocity: First argument ("+g+") was not a property map, a known action, or a registered redirect. Aborting.";return I.promise?I.rejecter(new Error(O)):console.log(O),e()}x="start"}var B={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},D=[];h.each(m,function(e,t){f.isNode(t)&&s.call(t)});var V,L=h.extend({},C.defaults,y);if(L.loop=parseInt(L.loop),V=2*L.loop-1,L.loop)for(var F=0;V>F;F++){var R={delay:L.delay,progress:L.progress};F===V-1&&(R.display=L.display,R.visibility=L.visibility,R.complete=L.complete),S(m,"reverse",R)}return e()}};C=h.extend(S,C),C.animate=S;var k=t.requestAnimationFrame||m;return C.State.isMobile||i.hidden===r||i.addEventListener("visibilitychange",function(){i.hidden?(k=function(e){return setTimeout(function(){e(!0)},16)},c()):k=t.requestAnimationFrame||m}),e.Velocity=C,e!==t&&(e.fn.velocity=S,e.fn.velocity.defaults=C.defaults),h.each(["Down","Up"],function(e,t){C.Redirects["slide"+t]=function(e,i,s,n,o,a){var l=h.extend({},i),d=l.begin,c=l.complete,u={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},p={};l.display===r&&(l.display="Down"===t?"inline"===C.CSS.Values.getDisplayType(e)?"inline-block":"block":"none"),l.begin=function(){d&&d.call(o,o);for(var i in u){p[i]=e.style[i];var r=C.CSS.getPropertyValue(e,i);u[i]="Down"===t?[r,0]:[0,r]}p.overflow=e.style.overflow,e.style.overflow="hidden"},l.complete=function(){for(var t in p)e.style[t]=p[t];c&&c.call(o,o),a&&a.resolver(o)},C(e,u,l)}}),h.each(["In","Out"],function(e,t){C.Redirects["fade"+t]=function(e,i,s,n,o,a){var l=h.extend({},i),d={opacity:"In"===t?1:0},c=l.complete;s!==n-1?l.complete=l.begin=null:l.complete=function(){c&&c.call(o,o),a&&a.resolver(o)},l.display===r&&(l.display="In"===t?"auto":"none"),C(this,d,l)}}),C}(window.jQuery||window.Zepto||window,window,document)}),define("chooser",["core","velocity"],function(e,t){function i(t){return this.select=t,this.size=7,this.chooser=null,this.placeholder=null,this.content=null,this.list=null,this.listHeight=0,this.items=[],this.visibleItems=[],this.tpl=null,this.itemSelected=null,this.itemHighlighted=null,this.itemHighlightedIndex=null,this.opened=!1,this.orientation="down",this.listeners={change:[]},this.mouseOnPlaceholder=!1,this.layout(),e.addClass(this.select,r.processedClass),this}var r={selectClass:"chooser-select",processedClass:"js-chooser",chooserClass:"chooser",chooserOpenClass:"chooser-open",placeholderClass:"chooser-placeholder",contentClass:"chooser-content",listClass:"chooser-list",searchClass:"chooser-search",searchInputClass:"chooser-search-input input_black",noResultsClass:"chooser-no-results hide",itemClass:"chooser-item",itemSelectedClass:"chooser-item-selected",itemHighlightedClass:"chooser-item-highlighted",disabledClass:"chooser-disabled",dataPlaceholder:"data-placeholder",dataSearch:"data-search",dataTpl:"data-tpl",dataItemIndex:"data-item-index",dataIndex:"data-index",noResultsText:'No results match "%s"',placeholderTpl:'<span></span><span class="glyphs icon-down"></span>',threshold:34,list:[],keyboard:{TAB:9,ENTER:13,ESCAPE:27,ARROW_UP:38,ARROW_DOWN:40},init:function(){for(var e=document.getElementsByClassName(this.selectClass),t=0;t<e.length;t++)this.bind(e[t])},get:function(e){return e&&r._processed(e)&&e.hasAttribute(this.dataIndex)?this.list[parseInt(e.getAttribute(this.dataIndex),10)]:null},bind:function(e){this._processed(e)||(e.setAttribute(this.dataIndex,this.list.length),r.list.push(new i(e)))},_processed:function(t){return e.hasClass(t,this.processedClass)},rectangle:function(e){if(e=e&&!e.nodeType?e[0]:e,!e||1!==e.nodeType)return!1;var t=e.getBoundingClientRect(),i=t.top+this.scrolly(),r=i+t.height;return{t:i,b:r}},viewport:function(){return{t:r.vt(),b:r.vb(),th:r.threshold}},vb:function(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)+this.scrolly()},vt:function(){return window.pageYOffset||document.documentElement.scrollTop},scrolly:function(){return window.pageYOffset||document.documentElement.scrollTop}};return i.prototype={layout:function(){this.transform(),this.events()},transform:function(){this.placeholder=document.createElement("SPAN"),e.addClass(this.placeholder,r.placeholderClass),this.placeholder.innerHTML=r.placeholderTpl,this.select.disabled||(this.placeholder.tabIndex=0),this.setPlaceholder(),this.content=document.createElement("DIV"),e.addClass(this.content,r.contentClass),this.list=document.createElement("UL"),e.addClass(this.list,r.listClass),this.setSearch(),this.setTemplate(),this.setList(),this.chooser=document.createElement("DIV"),e.addClass(this.chooser,r.chooserClass),this.chooser.appendChild(this.placeholder),this.chooser.appendChild(this.content),this.insertAfter(this.chooser,this.select),this.select.style.display="none",this.setSize(),this.setOrientation(),this.toggleDisableState()},update:function(){this.content.removeChild(this.list),this.items=[],this.visibleItems=[],this.list.removeEventListener("mousedown",this.handleItemClick),this.list.removeEventListener("touch",this.handleItemClick),this.list=null,this.list=document.createElement("UL"),e.addClass(this.list,r.listClass),this.setTemplate(),this.setList(),this.size=7,this.setSize(),this.list.addEventListener("mousedown",this.handleItemClick.bind(this)),this.list.addEventListener("touch",this.handleItemClick.bind(this)),this.toggleDisableState()},setList:function(){for(var t=this.select.options,i=0;i<t.length;i++){var s=t[i].getAttribute("class"),n=document.createElement("LI");e.addClass(n,r.itemClass),s&&e.addClass(n,s),n.setAttribute(r.dataItemIndex,t[i].index),this.parseTpl(n,t[i].text,t[i].getAttribute(r.dataTpl)),this.list.appendChild(n),this.items.push(n),this.visibleItems.push(n),i===this.select.selectedIndex&&this.set(n)}this.content.appendChild(this.list)},onItemClick:function(e){this.opened&&(this.set(e),this.close(),this._trigger("change"))},handlePlaceholderMouseEnter:function(e){this.mouseOnPlaceholder=!0},handlePlaceholderMouseLeave:function(e){this.mouseOnPlaceholder=!1},handlePlaceholderFocus:function(e){this.mouseOnPlaceholder||this.open()},handlePlaceholderBlur:function(e){this.mouseOnPlaceholder||this.close()},handleSearchInputBlur:function(e){this.mouseOnPlaceholder||this.close()},handleItemClick:function(e){var t=e.target;return t.classList.contains(r.itemClass)?void this.onItemClick(t):void(t.parentNode.classList.contains(r.itemClass)&&this.onItemClick(t.parentNode))},onKeyDown:function(e){if(e&&e.keyCode)switch(e.keyCode){case r.keyboard.ARROW_DOWN:case r.keyboard.ARROW_UP:e.preventDefault(),this.handleArrowKey(e.keyCode);break;case r.keyboard.ESCAPE:this.opened&&this.close();break;case r.keyboard.ENTER:case r.keyboard.TAB:this.opened&&(this.set(this.itemHighlighted),this.close(),this._trigger("change"))}},handleArrowKey:function(e){if(this.opened&&(e===r.keyboard.ARROW_DOWN||e===r.keyboard.ARROW_UP)){var t=e===r.keyboard.ARROW_DOWN?1:-1;if(null===this.itemHighlightedIndex)if(this.visibleItems.includes(this.itemSelected))for(var i=0;i<this.visibleItems.length&&null===this.itemHighlightedIndex;i++)this.visibleItems[i].classList.contains(r.itemSelectedClass)&&(this.itemHighlightedIndex=i);else this.itemHighlightedIndex=-t,this.setScrollPosition();var s=this.itemHighlightedIndex+t;s<this.visibleItems.length&&s>=0&&(this.itemHighlightedIndex=s,this.highlight(this.itemHighlightedIndex)),this.setScrollPosition(e)}},events:function(){var e=this;this.placeholder.addEventListener("mouseenter",this.handlePlaceholderMouseEnter.bind(this)),this.placeholder.addEventListener("mousedown",this.toggle.bind(this)),this.placeholder.addEventListener("mouseleave",this.handlePlaceholderMouseLeave.bind(this)),this.placeholder.addEventListener("keydown",this.onKeyDown.bind(this)),this.placeholder.addEventListener("focus",this.handlePlaceholderFocus.bind(this)),this.list.addEventListener("mousedown",this.handleItemClick.bind(this)),this.list.addEventListener("touch",this.handleItemClick.bind(this)),this.search?this.searchInput.addEventListener("blur",this.handleSearchInputBlur.bind(this)):this.placeholder.addEventListener("blur",this.handlePlaceholderBlur.bind(this)),document.addEventListener("click",function(t){if(e.opened){for(var i=t.target;i;i=i.parentNode)if(i===e.chooser)return;e.close()}}),this.search&&(this.searchInput.onkeyup=this.filter.bind(this),this.searchInput.addEventListener("keydown",this.onKeyDown.bind(this)))},set:function(t){isNaN(t)||(t=this.visibleItems[t]),t&&(this.itemSelected&&e.removeClass(this.itemSelected,r.itemSelectedClass),this.select.selectedIndex=parseInt(t.getAttribute(r.dataItemIndex),10),this.itemHighlightedIndex=this.select.selectedIndex,this.setPlaceholder(t.innerHTML),e.addClass(t,r.itemSelectedClass),this.search&&""!==this.searchInput.value&&(this.searchInput.value="",this.filter()),this.itemSelected=t)},highlight:function(t,i){!this.visibleItems.length>0||0>t||t===this.visibleItems.length||(!isNaN(t)&&this.visibleItems.length>0&&(t=this.visibleItems[t]),this.itemHighlighted&&e.removeClass(this.itemHighlighted,r.itemHighlightedClass),this.itemSelected&&!this.itemSelected.classList.contains("hide")&&e.removeClass(this.itemSelected,r.itemSelectedClass),e.addClass(t,r.itemHighlightedClass),this.itemHighlighted=t)},filter:function(t){if(!t||t.keyCode!==r.keyboard.ARROW_UP&&t.keyCode!==r.keyboard.ARROW_DOWN&&t.keyCode!==r.keyboard.ENTER&&t.keyCode!==r.keyboard.TAB){var i=this.searchInput.value.toLowerCase();e.addClass(this.noResults,"hide");for(var s=0,n=0;n<this.items.length;n++){var o=this.items[n].textContent.toLowerCase();o.indexOf(i)>-1?e.removeClass(this.items[n],"hide"):(e.addClass(this.items[n],"hide"),s++)}s===this.items.length&&(this.noResults.textContent=r.noResultsText.replace("%s",i),e.removeClass(this.noResults,"hide")),this.visibleItems=this.items.filter(function(e){return!e.classList.contains("hide")});var a=this.visibleItems.filter(function(e){return e.classList.contains(r.itemSelectedClass)});0===a.length&&(this.itemHighlightedIndex=null,this.setScrollPosition())}},toggle:function(){this.opened?this.close():this.open()},open:function(){var i=this;i.opened||(this.checkOrientation(),t(i.content,{opacity:1},{duration:100,display:"block",complete:function(){i.itemHighlighted&&(e.removeClass(i.itemHighlighted,r.itemHighlightedClass),i.itemHighlighted=null,i.itemHighlightedIndex=null),i.itemSelected&&e.addClass(i.itemSelected,r.itemSelectedClass),i.setScrollPosition(),i.search&&(i.placeholder.tabIndex=-1,i.searchInput.focus()),e.addClass(i.chooser,r.chooserOpenClass),i.content.removeAttribute("style"),i.opened=!0}}))},close:function(){var i=this;i.opened&&t(i.content,{opacity:0},{duration:100,display:"none",complete:function(){i.search&&(i.placeholder.tabIndex=0),e.removeClass(i.chooser,r.chooserOpenClass),i.content.removeAttribute("style"),i.itemHighlightedIndex=null,i.opened=!1}})},checkOrientation:function(){switch(e.removeClass(this.chooser,r.chooserClass+"-up"),this.orientation){case"auto":var t=r.viewport(),i=r.rectangle(this.chooser);t.b-t.th<i.b+this.listHeight&&i.t-t.t+t.th>t.b-t.th-i.b&&e.addClass(this.chooser,r.chooserClass+"-up");break;case"up":e.addClass(this.chooser,r.chooserClass+"-"+this.orientation)}},parseTpl:function(e,t,i){if(i){var r=JSON.parse(i),s=null;for(var n in r)r.hasOwnProperty(n)&&(s=(s?s:this.tpl).replace("%"+n+"%",r[n]));e.innerHTML=s}else e.innerHTML=t},setTemplate:function(){var e=this.select.getAttribute(r.dataTpl);if(e&&""!==e){var t=JSON.parse(e);if(t instanceof Array){for(var i=document.createElement("DIV"),s=0;s<t.length;s++){var n;if(t[s].hasOwnProperty("tag")&&t[s].hasOwnProperty("attr")&&t[s].hasOwnProperty("text")){if(n=document.createElement(t[s].tag.toUpperCase()),t[s].attr)for(var o in t[s].attr)t[s].attr.hasOwnProperty(o)&&n.setAttribute(o,t[s].attr[o]);t[s].text&&(n.textContent=t[s].text)}i.appendChild(n)}this.tpl=i.innerHTML}}},setSearch:function(){var t=this.select.getAttribute(r.dataSearch);"true"===t&&(this.search=document.createElement("DIV"),e.addClass(this.search,r.searchClass),this.searchInput=document.createElement("INPUT"),this.searchInput.type="search",this.searchInput.autocomplete="off",e.addClass(this.searchInput,r.searchInputClass),this.search.appendChild(this.searchInput),this.content.appendChild(this.search),this.noResults=document.createElement("LI"),e.addClass(this.noResults,r.noResultsClass),this.list.appendChild(this.noResults))},toggleDisableState:function(){var t=this.select.disabled;t?(e.addClass(this.chooser,r.disabledClass),this.placeholder.tabIndex=-1):(e.removeClass(this.chooser,r.disabledClass),this.placeholder.tabIndex=0)},setPlaceholder:function(e){this.placeholder.childNodes[0].innerHTML=e||this.select.getAttribute(r.dataPlaceholder)},setSize:function(){var e=this.select.getAttribute("size");e&&parseInt(e,10)<this.size&&(this.size=parseInt(e,10)),this.items&&this.size>this.items.length&&(this.size=this.items.length),this.content.style.position="absolute",this.content.style.visibility="hidden",this.content.style.display="block";for(var t=0,i=0;i<this.size;i++)t+=this.items[i].offsetHeight;this.content.removeAttribute("style"),this.listHeight=t,this.list.style.maxHeight=t+"px"},setOrientation:function(){var e=this.select.getAttribute("data-orientation");e&&(this.orientation=e)},insertAfter:function(e,t){t.parentNode.insertBefore(e,t.nextSibling)},on:function(e,t){this.listeners[e]&&this.listeners[e].push(t)},_trigger:function(e){for(var t=0,i=this.listeners[e].length;i>t;t++)this.listeners[e][t]()},setScrollPosition:function(e){switch(e){case r.keyboard.ARROW_UP:if(this.itemHighlighted){var t=this.itemHighlighted.offsetTop,i=this.itemHighlighted.offsetHeight,s=t-this.list.scrollTop;(i>s||s>this.listHeight)&&(this.list.scrollTop=t-i)}break;case r.keyboard.ARROW_DOWN:if(this.itemHighlighted){var t=this.itemHighlighted.offsetTop,i=this.itemHighlighted.offsetHeight,s=t+i-this.list.scrollTop;s>this.listHeight+i?this.list.scrollTop=t-i:s>this.listHeight?this.list.scrollTop+=i:t<this.list.scrollTop&&(this.list.scrollTop=t-i)}break;default:if(this.itemSelected){var n=this.itemSelected.offsetTop,o=this.itemSelected.offsetHeight;this.list.scrollTop=n-o}}}},i}),define("formValidatorConstants",{NAME:"FormValidator",INPUT_SELECTOR:"input,select,textarea",STATES:{DIRTY:"dirty",VIRTUALLY_DIRTY:"virtually_dirty",VISITED:"visited",SUBMITTED:"submitted",ERROR:"form-validator_error"},EVENTS:{SUBMIT_FORM:"submit",VALIDATION_FAILED:"VALIDATION_FAILED"}}),define("formValidatorMethods",["pub_sub","core","formValidatorConstants"],function(e,t,i){function r(e,t){e&&e.classList&&e.classList.add(t)}function s(e,t){return e&&e.classList&&e.classList.contains(t)}function n(e,t){e&&e.classList&&e.classList.remove(t)}function o(e){var t=window.getComputedStyle(e);return null===e.offsetParent&&"none"!==t.display}function a(e,t){var i=[];return t&&t.length>0&&(i=t.filter(function(t){return t.sourceInput===e})),i}function l(e){if(e&&e.parentNode){var t=e.parentNode.querySelector("span."+i.STATES.ERROR);t&&t.classList&&(t.classList.add("hide"),e.setCustomValidity(""))}}function d(e,t){if(t&&t.length>0)for(var r,s=a(e,t),o=0;o<s.length;o++)r=s[o].errorMessageInput||s[o].sourceInput,l(r),n(r,i.STATES.VIRTUALLY_DIRTY),s[o].errorState=!0}function c(e){for(var t=0;t<e.length;t++)l(e[t])}function u(e){r(e.currentTarget,i.STATES.DIRTY)}function h(e){r(e.currentTarget,i.STATES.VISITED),s(e.currentTarget,i.STATES.DIRTY)&&this.validateInput(e.currentTarget)}function p(e){for(var t,i,r=!0,s=0;s<e.length;s++){t=e[s].element;for(var n in e[s].validation)if(e[s].validation[n]&&t.dataset.hasOwnProperty(n)){i=t.dataset[n],m(t,i),r=!1;break}}return r}function m(e,t){var r=e.parentNode.querySelector("span."+i.STATES.ERROR);r?(r.innerHTML=t,r.classList.remove("hide")):(r=document.createElement("SPAN"),r.innerHTML=t,r.classList.add(i.STATES.ERROR),e.parentNode.appendChild(r))}function f(e){return{element:e,validation:e.validity}}function g(e,t){var i=a(e,t);return y(i)}function v(e,t){var i=a(e,t);C(i)}function y(e){if(!e||0===e.length)return!0;for(var t,i,r=!0,s=0;s<e.length;s++)i=e[s],t=i.validationMethod(),i.errorState=!!t,E(t,i),!t&&r&&(r=!1);return r}function C(e){return e&&0!==e.length?void b(e,0):!0}function b(e,t){if(!(t>e.length-1)){var s=e[t];s.validationMethod().then(function(n){s.errorMessageInput?d(s.errorMessageInput,e):d(s.sourceInput,e),s.success(n),r(s.sourceInput,i.STATES.VISITED),r(s.sourceInput,i.STATES.DIRTY),b(e,t+1)},function(e){var t=s.parser(e);t&&E(t,s),s.failure(e)})}}function E(e,t){"boolean"!=typeof e||e?"string"==typeof e&&e.length>0&&(t.errorMessageInput?(r(t.errorMessageInput,i.STATES.VIRTUALLY_DIRTY),t.errorMessageInput.setCustomValidity(e),m(t.errorMessageInput,e)):(t.sourceInput.setCustomValidity(e),m(t.sourceInput,e))):t.errorMessageInput?(r(t.errorMessageInput,i.STATES.VIRTUALLY_DIRTY),t.errorMessageInput.setCustomValidity(t.errorMessage),m(t.errorMessageInput,t.errorMessage)):(t.sourceInput.setCustomValidity(t.errorMessage),m(t.sourceInput,t.errorMessage))}var S={loadEvents:function(e,t){for(var i=0;i<e.formElements.length;i++)t&&t.validateOnChange&&e.formElements[i].addEventListener("change",u.bind(e)),t&&t.validateOnBlur&&e.formElements[i].addEventListener("blur",h.bind(e))},validateForm:function(e){var t=e.form.checkValidity(),s=[];if(c(e.formElements),r(e.form,i.STATES.SUBMITTED),!t)for(var n=e.formElements.length,a=0;n>a;a++){var l=e.formElements[a];o(l)||l.validity.valid||s.push(f(l))}var d=p(s),u=y(e.customValidations);if(d&&u){C(e.asyncCustomValidations)}return d&&u},validateInput:function(t,r){l(t);var s=t.checkValidity(),n=[];return s?(s=g(t,r.customValidations),s&&v(t,r.asyncCustomValidations)):(n.push(f(t)),p(n)),s||e.emit(i.EVENTS.VALIDATION_FAILED,{elem:t}),s},addCustomValidation:function(e,t,i,r,s){if(e&&t&&(!i||"string"==typeof i&&0!==i.length)){i&&t&&e.addEventListener(i,t);var n={sourceInput:e,validationMethod:t,errorMessage:r,errorMessageInput:s,errorState:!0};return n}throw"error: Wrong parameters."},addAsyncCustomValidation:function(e,t,i,r,s){if(e&&t&&"function"==typeof t&&i&&"function"==typeof i&&r&&"function"==typeof r){var n={sourceInput:e,validationMethod:t,parser:i,success:r,failure:s,errorState:!0};return n}throw"error: Invalid Paramters."},removeCustomValidation:function(e,t,i){if(!e||!i||"function"!=typeof i||t&&("string"!=typeof t||0===t.length))throw"error: Invalid Paramters.";e.removeEventListener(t,i)},removeValidations:function(e){c(e.formElements),n(e.form,i.STATES.SUBMITTED);for(var t=0;t<e.formElements.length;t++)n(e.formElements[t],i.STATES.DIRTY),n(e.formElements[t],i.STATES.VIRTUALLY_DIRTY),n(e.formElements[t],i.STATES.VISITED)},setValidationState:function(e,t){r(e,t)}};return S}),define("formValidator",["formValidatorMethods","formValidatorConstants"],function(e,t){var i=function(){if(this.form=null,this.formElements=null,this.customValidations=[],this.asyncCustomValidations=[],!(arguments&&arguments.length>=1))throw"error: invalid arguments. Please provide at least 1 argument to specify the form context";this.init(arguments[0],arguments[1]||{})};return i.prototype={init:function(i,r){if(this.form=i,r=r||{},r.validateOnBlur="undefined"==typeof r.validateOnBlur||r.validateOnBlur,r.validateOnChange="undefined"==typeof r.validateOnChange||r.validateOnChange,!this.form)throw t.NAME+" is not loaded!";this.formElements=this.form.querySelectorAll(t.INPUT_SELECTOR),e.loadEvents(this,r)},validateForm:function(){return e.validateForm(this)},validateInput:function(t){return e.validateInput(t,this)},addCustomValidation:function(t,i,r,s,n){var o=e.addCustomValidation(t,i,r,s,n);o&&this.customValidations.push(o)},removeCustomValidation:function(t,i,r,s,n){e.removeCustomValidation(t,i,r)},addAsyncCustomValidation:function(t,i,r,s,n){var o=e.addAsyncCustomValidation(t,i,r,s,n);o&&this.asyncCustomValidations.push(o)},removeValidations:function(){return e.removeValidations(this)},setValidationState:function(t,i){e.setValidationState(t,i)},validationStates:t.STATES,events:t.EVENTS},i}),define("creditCardMaskMethods",["constants","pub_sub"],function(e,t){var i=".js-creditCardTypes",r={self:null,value:"",mask:"",pattern:"",caretStart:0,caretEnd:0},s=!1,n={init:function(e){if(r.self=e,this.creditCardTypeSelector=this.getCreditCardSelector(),this.creditCardTypeSelector){var t=this.creditCardTypeSelector.options[this.creditCardTypeSelector.selectedIndex],i={mask:t.getAttribute("data-mask"),pattern:t.getAttribute("data-pattern"),maxlength:t.getAttribute("data-maxlength")};this.updateCreditCardMetadata(i)}this.loadEvents()},loadEvents:function(){r.self.addEventListener("keyup",this.keyUpEventHandler.bind(this)),r.self.addEventListener("paste",this.pasteEventHandler.bind(this)),r.self.addEventListener("input",this.inputEventHandler.bind(this)),t.on(e.events.CREDIT_CARD_TYPE_CHANGED,this.updateCreditCardMetadata.bind(this))},getCreditCardSelector:function(){return r.self.form&&r.self.form.querySelector(i)},applyMask:function(e,t){for(var i="",r=t.replace(/[^0-9]/g,""),s=0,n=0;s<e.length&&n<r.length;s++,n++)"#"===e[s]?i+=r[n]:(i+=e[s],n--);return i},updateCreditCardMetadata:function(e){r.self.maxLength=e.maxlength,r.self.dataset.mask=e.mask,r.self.pattern=e.pattern,r.mask=e.mask,r.pattern=e.pattern},keyUpEventHandler:function(e){if(r.caretStart=r.self.selectionStart,r.caretEnd=r.self.selectionEnd,r.value!==r.self.value){var t=r.self.value.substring(0,r.caretStart),i=t.match(/ /g),s=this.applyMask(r.mask,r.self.value);if(r.caretStart===r.caretEnd){var n=s.substring(0,r.caretStart),o=n.match(/ /g);i&&(r.caretStart-=i.length),o&&(r.caretStart+=o.length),r.caretEnd=r.caretStart}r.self.value=s,r.value=s,r.self.setSelectionRange(r.caretStart,r.caretEnd)}},pasteEventHandler:function(e){s=!0},inputEventHandler:function(e){s&&(s=!1,this.keyUpEventHandler(e))}};return n}),define("creditCardMask",["creditCardMaskMethods"],function(e){var t=function(t){e.init(t)};return t}),define("creditCardForm",["requester","pub_sub","constants","chooser","formValidator","creditCardMask"],function(e,t,i,r,s,n){function o(){var e=this.CreditCardSelectors.number.obj.value;if(-1!==e.toUpperCase().indexOf("X")&&!this.CreditCardSelectors.number.obj.classList.contains("dirty"))return!0;if(0===e.length)return!0;if(/[^0-9-\s]+/.test(e))return!1;var t=0,i=0,r=!1;e=e.replace(/\D/g,"");for(var s=e.length-1;s>=0;s--){var n=e.charAt(s),i=parseInt(n,10);r&&(i*=2)>9&&(i-=9),t+=i,r=!r}var o=t%10==0;return a(o),o}function a(e){C||(C=!0,setTimeout(function(){var r="success";e||(r="unsuccess");var s={tid:i.userActionTracker.TRK_CREDIT_CARD_VALIDATION,val:JSON.stringify({status:r})};t.emit(i.events.TRK,s)},500))}function l(e){C=!1,setTimeout(function(){var e={tid:i.userActionTracker.TRK_CREDIT_CARD_NUMBER_CHANGED};t.emit(i.events.TRK,e)},250)}var d="mod-creditCardForm",c="creditCardForm",u=".creditCardForm",h=".js-creditCardTypes",p=".js-cardName",m=".js-cardNumber",f=".js-expireMM",g=".js-expireYY",v=".js-cvv",y=".js-chooser-select",C=!1,b=function(e){this.module=e?document.getElementById(d+"-"+e):document.getElementById(d),this.creditTypeSelectElem=null,this.selectElements={},this.chooserElements={},this.form=null,this.formValidator=null,this.CreditCardSelectors={type:{selector:h,disabledOnEdit:!0},number:{selector:m,disabledOnEdit:!0,editPlaceholder:"XXXX XXXX XXXX "},name:{selector:p,disabledOnEdit:!0},expiremm:{selector:f,disabledOnEdit:!1},expireyy:{selector:g,disabledOnEdit:!1},cvv:{selector:v,disabledOnEdit:!1}}};return b.prototype.init=function(){if(!this.module)throw c+" is not loaded! Check if you have a node with the id: "+d;this.creditTypeSelectElem=this.module.querySelector(h),this.selectElements=this.module.querySelectorAll(y),this.form=this.module.querySelector(u),this.formValidator=new s(this.form),this.loadSelectorElements(),this.initChooser(),this.loadEvents(),this.ccMask=new n(this.CreditCardSelectors.number.obj)},b.prototype.loadEvents=function(){var e=this,r=this.CreditCardSelectors.number.obj;r.addEventListener("focus",this.creditCardNumberFocused.bind(this)),r.addEventListener("change",l),t.on(this.formValidator.events.VALIDATION_FAILED,a.bind(this,!1));for(var s=0;s<this.selectElements.length;s++)this.selectElements.hasOwnProperty(s)&&this.chooserElements.hasOwnProperty(this.selectElements[s].name)&&this.chooserElements[this.selectElements[s].name].on("change",this.formValidator.validateInput.bind(this,this.selectElements[s]));this.chooserElements[this.creditTypeSelectElem.name].on("change",function(e){var r=this.chooserElements[this.creditTypeSelectElem.name].itemSelected,s=null;if(r){var n=r.getAttribute("data-item-index"),o=this.creditTypeSelectElem.options[n];s={pattern:o.getAttribute("data-pattern"),mask:o.getAttribute("data-mask"),maxlength:o.getAttribute("data-maxlength")}}t.emit(i.events.CREDIT_CARD_TYPE_CHANGED,s)}.bind(this));var n=r.dataset.customPattern;e.formValidator.addCustomValidation(r,o.bind(this),null,n)},b.prototype.initChooser=function(){for(var e=0;e<this.selectElements.length;e++)this.selectElements.hasOwnProperty(e)&&(this.chooserElements[this.selectElements[e].name]=new r(this.selectElements[e]))},b.prototype.creditCardNumberFocused=function(){var e=this.CreditCardSelectors.number;e.obj&&-1!==e.obj.value.indexOf(e.editPlaceholder)&&(e.obj.value="")},b.prototype.getSelectedCreditCardInfo=function(e){return{value:e.value,mask:e.dataset.mask,pattern:e.dataset.pattern,maxlength:e.dataset.maxlength}},b.prototype.loadSelectorElements=function(){for(var e in this.CreditCardSelectors)this.CreditCardSelectors.hasOwnProperty(e)&&(this.CreditCardSelectors[e].obj=this.module.querySelector(this.CreditCardSelectors[e].selector))},b.prototype.validateForm=function(){return this.formValidator?this.formValidator.validateForm():null},b.prototype.getCreditCardInfo=function(){var e=this.CreditCardSelectors;for(var t in e)if(this.CreditCardSelectors.hasOwnProperty(t)){var i=e[t].obj;i&&("select"===i.type&&i.options?e[t].value=i.options[i.selectedIndex].value:e[t].value=i.value)}var r=this,s={NameOnCard:r.CreditCardSelectors.name.value,ExpirationMonth:r.CreditCardSelectors.expiremm.value,ExpirationYear:r.CreditCardSelectors.expireyy.value,CardTypes:{},SelectedCardType:r.CreditCardSelectors.type.value},n=this.retrieveCreditCardNumber(this.CreditCardSelectors.number.value);return n&&(s.CardNumber=this.CreditCardSelectors.number.value),isNaN(this.CreditCardSelectors.cvv.value)||(s.SecurityCode=this.CreditCardSelectors.cvv.value),s},b.prototype.retrieveCreditCardNumber=function(e){var t=e.replace(/\s/g,"");return isNaN(t)?null:t},b.prototype.unload=function(){},b.prototype.fillInCreditCardForm=function(e){if(this.formValidator.removeValidations(),e){var t=this.CreditCardSelectors;for(var i in t)if(this.CreditCardSelectors.hasOwnProperty(i)){var r=t[i].obj;if(r){r.disabled=t[i].disabledOnEdit;var s=e[i];if(t[i].editPlaceholder&&(s=t[i].editPlaceholder+e[i]),"SELECT"===r.nodeName&&r.options)for(var n=0;n<r.options.length;n++){if(r.options[n].value===s){r.value=s,t[i].value=s,t[i].selectedIndex=r.selectedIndex=n,r[n].setAttribute("selected","");break}r[n].removeAttribute("selected")}else t[i].value=t[i].obj.value=r.placeholder=s}}this.chooserElements[this.creditTypeSelectElem.name].toggleDisableState();for(var n=0;n<this.selectElements.length;n++)if(this.selectElements.hasOwnProperty(n)&&this.chooserElements.hasOwnProperty(this.selectElements[n].name)){
var o=this.selectElements[n].name;this.CreditCardSelectors.hasOwnProperty(o)&&this.CreditCardSelectors[o]&&this.CreditCardSelectors[o].selectedIndex&&this.chooserElements[this.selectElements[n].name].set(this.CreditCardSelectors[o].selectedIndex)}}},b.prototype.cleanCreditCardForm=function(){var e=this.CreditCardSelectors;for(var t in e)if(this.CreditCardSelectors.hasOwnProperty(t)){var i=e[t].obj;"select"===i.type&&i.options?e[t].selectedIndex=0:(e[t].value=i.value=i.placeholder="",e[t].editPlaceholder&&(i.placeholder=""),e[t].disabledOnEdit&&(i.disabled=!1))}this.chooserElements[this.creditTypeSelectElem.name].toggleDisableState();for(var r=0;r<this.selectElements.length;r++)if(this.selectElements.hasOwnProperty(r)&&this.chooserElements.hasOwnProperty(this.selectElements[r].name)){var s=this.selectElements[r].name;this.CreditCardSelectors.hasOwnProperty(s)&&this.CreditCardSelectors[s]&&this.chooserElements[this.selectElements[r].name].set(0)}this.formValidator.removeValidations()},b}),define("modulesFactory",["Base"],function(e){var t=function(){};return t.prototype.loadModulesByCountryForParent=function(){var e="string"==typeof arguments[0]&&arguments[0].toUpperCase(),t=arguments[1],i=arguments[2],r=arguments[3],s=arguments[4],n=[];switch(e){case"BR":this.requireModuleZipCodeSearcherBrazil(t,r,i),this.requireCpfValidator(t,s),n=["zipCodeFinderBrazil","cpfInput"];break;case"JP":this.requireModuleZipCodeSearcherJapan(t,r),n=["zipCodeFinder"];break;case"CN":this.requireModuleDropDownDependency(t,i,e),n=["dropdownDependency"]}return n},t.prototype.requireModuleZipCodeSearcherJapan=function(t,i){var r="zipCodeFinder";require([r],function(s){var n=new s(t,i);e.addModule(r,n,!0)})},t.prototype.requireModuleZipCodeSearcherBrazil=function(t,i,r){var s="zipCodeFinderBrazil";require([s],function(n){var o=new n(t,i,r);e.addModule(s,o,!0)})},t.prototype.requireModuleDropDownDependency=function(t,i,r){var s="dropdownDependency";require([s],function(n){e.addModule(s,new n(t,i,r),!0)})},t.prototype.requireCpfValidator=function(t,i){var r="cpfInput";require([r],function(s){var n={formValidator:i};e.addModule(r,new s(t,n),!1)})},new t}),define("inputMaskConstants",{DEFAULT_SELECTOR:".js-mask",DEFAULT_CLASS:"js-mask",CONTAINER_CLASS:"mask-container",DIGIT_PLACEHOLDERS:"X_",WORD_PLACEHOLDERS:"W",MASK_SEPARATORS:"-."}),define("inputMaskMethods",["core","inputMaskConstants"],function(e,t){var i=t.DEFAULT_SELECTOR,r=t.DEFAULT_CLASS,s=t.CONTAINER_CLASS,n=t.DIGIT_PLACEHOLDERS,o=t.WORD_PLACEHOLDERS,a=t.MASK_SEPARATORS,l=navigator.userAgent,d=/chrome/i.test(l),c=/android/i.test(l),u=function(){function t(e,t){t&&(i=t.maskSelector||i,n=t.digitPlaceholders||n,o=option._wordPlaceholders||o,a=option._maskSeparators||a),S=e||document,k=S.querySelectorAll(i),T={},l()}function l(){for(var e=0;e<k.length;e++)maskedElement=k[e],parentClass=maskedElement.parentNode.getAttribute("class"),(!parentClass||parentClass&&-1===parentClass.indexOf(s))&&(u(maskedElement),h(maskedElement),T[maskedElement.name]=p(maskedElement))}function u(e){var t=document.createElement("span"),i=document.createElement("span"),n=document.createElement("i"),o=e.getAttribute("class"),a=e.getAttribute("placeholder"),l=document.createTextNode(a);e.setAttribute("maxlength",l.length),e.setAttribute("data-placeholder",a),e.removeAttribute("placeholder"),(!o||o&&-1===o.indexOf(r))&&e.setAttribute("class",o+" "+r),i.setAttribute("aria-hidden","true"),i.setAttribute("id",e.getAttribute("name")+"Mask"),i.appendChild(n),i.appendChild(l),t.setAttribute("class",s),t.appendChild(i),e.parentNode.insertBefore(t,e)}function h(e){e.addEventListener("input",y.bind(this,e)),d&&c&&e.addEventListener("keyup",f.bind(this,e))}function p(e){for(var t=e.getAttribute("data-placeholder"),i=t.length,r=!1,s=[],n=0;i>n;n++)r=a.indexOf(t[n]),r>=0&&s.push(n+1);return s}function m(e){for(var t=!1,i=T[e.name],r=0;r<i.length;r++)if(A===i[r]){t=!0;break}return t}function f(e,t){var i=m(e);if(i){var r=t.which||t.keyCode;8===r?e.selectionStart=e.selectionEnd=A-1:e.selectionStart=e.selectionEnd=A+1}}function g(e,t){var i=e.value;if(0===i.length)e.selectionEnd=0;else{var r=m(e),s=i.length<t.length;r&&s?e.selectionEnd=A-1:r?e.selectionEnd=A+1:e.selectionEnd=A}}function v(){for(var e=0;e<k.length;e++)maskedElement=k[e],y(maskedElement)}function y(e){var t=C(e);e.value!==t&&(e.value=E(e),g(e,t),b(e))}function C(e){var t=e.getAttribute("name");return S.querySelector("#"+t+"Mask i")&&S.querySelector("#"+t+"Mask i").innerHTML}function b(t){var i=t.getAttribute("name"),r=e.htmlEncode(t.value),s=t.getAttribute("data-placeholder"),n="<i>"+r+"</i>"+s.substr(r.length);S.querySelector("#"+i+"Mask").innerHTML=n}function E(e){var t,i,r,s,a,l,d,c=e.getAttribute("data-charset"),u=c||e.getAttribute("data-placeholder"),h=e.value,p=u.length,m="";for(a=c?h.replace(/\W/g,""):h.replace(/\D/g,""),t=0,i=0;p>t;t++){if(r=!isNaN(parseInt(a[i])),s=a[i]?a[i].match(/[A-Z]/i):!1,l=n.indexOf(u[t])>=0,d=o.indexOf(u[t])>=0,l&&r||c&&d&&s)m+=a[i++];else{if(!c&&!r&&l||c&&(d&&!s||l&&!r))return m;m+=u[t]}if(void 0==a[i])break}return A=e.selectionEnd,m}var S,k,T,A;return{init:t,handleValueChange:y,validateAllMasks:v}};return u}),define("inputMask",["inputMaskMethods"],function(e){var t=function(t,i){this.methods=new e,this.methods.init(t,i)};return t.prototype.apply=function(e){this.methods.handleValueChange(e)},t.prototype.validate=function(){this.methods.validateAllMasks()},t}),define("addressForm",["Base","pub_sub","chooser","formValidator","constants","requester","modulesFactory","loading","core","inputMask"],function(e,t,i,r,s,n,o,a,l,d){var c="mod-addressForm",u="AddressForm",h=".js-addressForm",p=".js-country",m="js-isDefaultBilling",f=".chooser-select",g=".form",v="[data-form-block-nrc=true]",y="#js-nonromancharacters-message",C="#js-alpha-numeric-message",b="input[type='text']",E="[data-block-nrc=true]",S=function(e){this.module=e,this.form=null,this.maskHandler=null,this.formValidator=null,this.selectElements={},this.chooserElements={},this.countrySelectElem=null,this.loadedModules=[]};return S.prototype.init=function(){if(!this.module)throw u+" is not loaded! Check if you have a node with the id: "+c;this.isDefaultBilling=this.module.querySelector("."+m),this.selectElements=this.module.querySelectorAll(f),this.countrySelectElem=this.module.querySelector(p),this.form=this.module.querySelector(h)||this.module.querySelector("form"),this.formValidator=new r(this.form),this.formLoadingcontainer=this.module.parentElement.parentElement,this.hasCountryDropDownElement()&&this.configureCountryChooser(),this.initChooser(),this.initMaskHandler(),this.handleEventForZipCodeStartFetching=this.handleEventForZipCodeStartFetching.bind(this),this.handleEventForZipCodeEndFetching=this.handleEventForZipCodeEndFetching.bind(this),this.loadModulesBySelectedCountry(),this.loadEvents(),this.isFormOnEditMode()&&(this.validate(),this.validateMasks())},S.prototype.loadEvents=function(){for(var e=0;e<this.selectElements.length;e++)this.selectElements.hasOwnProperty(e)&&this.chooserElements.hasOwnProperty(this.selectElements[e].name)&&this.chooserElements[this.selectElements[e].name].on("change",this.validateInput.bind(this,this.selectElements[e]));this.hasCountryDropDownElement()&&this.chooserElements[this.countrySelectElem.name].on("change",this.changeCountryDropdown.bind(this,this.countrySelectElem.value)),this.applyNonRomanCharactersValidations()},S.prototype.isFormOnEditMode=function(){return"true"===this.module.dataset.editMode},S.prototype.hasCountryDropDownElement=function(){return this.countrySelectElem&&this.countrySelectElem.name&&"SELECT"===this.countrySelectElem.tagName},S.prototype.configureCountryChooser=function(){this.countrySelectElem.dataset.tpl='[{"tag":"span","attr":{"class":"flags %flag%"},"text":"%text%"}]';for(var e=this.countrySelectElem.options,t=0;t<e.length;t++){var i=e[t].value,r=e[t].text;i&&r&&(e[t].dataset.tpl='{"flag":"flag-'+i.toLowerCase()+'","text":"'+r+'"}')}},S.prototype.loadModulesBySelectedCountry=function(){for(var e=[this.getSelectedCountry(),this.form,this.chooserElements,this.isFormOnEditMode(),this.formValidator],t=o.loadModulesByCountryForParent.apply(o,e),i=0;i<t.length;i++)this.loadEventsByModule(t[i]);this.loadedModules=this.loadedModules.concat(t)},S.prototype.loadEventsByModule=function(e){this.handleEventsByModule(t.on.bind(t),e)},S.prototype.unloadEventsByModule=function(e){this.handleEventsByModule(t.off.bind(t),e)},S.prototype.handleEventsByModule=function(e,t){switch(t){case"zipCodeFinder":case"zipCodeFinderBrazil":e(s.events.ZIPCODE_START_FETCHING,this.handleEventForZipCodeStartFetching),e(s.events.ZIPCODE_END_FETCHING,this.handleEventForZipCodeEndFetching)}},S.prototype.handleEventForZipCodeStartFetching=function(e){t.emit(a.MODULE_LOADING,this.formLoadingcontainer)},S.prototype.handleEventForZipCodeEndFetching=function(e){t.emit(a.MODULE_LOADED,this.formLoadingcontainer),e&&!e.status&&t.emit(s.events.ERROR_RAISED,err)},S.prototype.getSelectedCountry=function(){return this.countrySelectElem&&""!==this.countrySelectElem.value?this.countrySelectElem.value:void 0},S.prototype.applyNonRomanCharactersValidations=function(){if(this.module.dataset&&this.module.dataset.nrcErrorMessage){var e,t=this.module.dataset.nrcErrorMessage,i=this.module.querySelector(v),r=this.module.querySelector(y),s=this.module.querySelector(C),n="hide";i?(l.removeClass(s,n),l.addClass(r,n),e=this.module.querySelectorAll(b)):(l.addClass(s,n),l.removeClass(r,n),e=this.module.querySelectorAll(E));for(var o=0;o<e.length;o++){var a=e[o];this.formValidator.addCustomValidation(a,this.nonRomanCharacters.bind(this,a),null,t)}}},S.prototype.initChooser=function(){for(var e=0;e<this.selectElements.length;e++)this.selectElements.hasOwnProperty(e)&&(this.chooserElements[this.selectElements[e].name]=new i(this.selectElements[e]))},S.prototype.initMaskHandler=function(){this.maskHandler=new d(this.form)},S.prototype.validateMasks=function(){this.maskHandler.validate()},S.prototype.validate=function(){return this.formValidator?this.formValidator.validateForm():!1},S.prototype.validateInput=function(e){return this.formValidator?this.formValidator.validateInput(e):!1},S.prototype.getSpecificAddressFormError=function(){for(var t=0;t<this.loadedModules.length;t++){var i=e.getModule(this.loadedModules[t]),r=i.getErrorMessage&&i.getErrorMessage();if(r&&r.isValid)return r}return null},S.prototype.serialize=function(){for(var e={},t=0;t<this.form.elements.length;t++){var i=this.form.elements[t];"search"===i.type||"INPUT"!==i.tagName&&"SELECT"!==i.tagName||("checkbox"===i.type?i.classList.contains(m)||(e[i.name]=i.checked):e[i.name]=i.value)}return e},S.prototype.getIsDefaultBilling=function(){return this.isDefaultBilling&&this.isDefaultBilling.checked},S.prototype.getIsCurrentDefaultBilling=function(){return this.module.dataset&&this.module.dataset.currentBilling?"true"===this.module.dataset.currentBilling.toLowerCase():!1},S.prototype.getAddressId=function(){return this.module.dataset&&this.module.dataset.addressId?this.module.dataset.addressId:null},S.prototype.changeCountryDropdown=function(e){var i=this.getSelectedCountry();if(i!==e){var r=this.countrySelectElem.dataset&&this.countrySelectElem.dataset.actionUrl+"?countryCode="+i,o=this.module.querySelector(g);if(null!==o){var l={method:"GET",url:r,dataType:"file"},d=this;t.emit(a.MODULE_LOADING,this.formLoadingcontainer),n(l).then(function(e){e&&(d.unloadModules(),o.outerHTML=e,d.module.dataset.editMode="false",d.formValidator.removeValidations(),d.init(),t.emit(a.MODULE_LOADED,d.formLoadingcontainer))},function(e){t.emit(a.MODULE_LOADED,d.formLoadingcontainer),t.emit(s.events.ERROR_RAISED,e)})}}},S.prototype.unloadModules=function(){for(var t=0;t<this.loadedModules.length;t++)e.removeModule(this.loadedModules[t]),this.unloadEventsByModule(this.loadedModules[t]);this.loadedModules=[]},S.prototype.nonRomanCharacters=function(e){var i=/[^\u0020-\u007E\u000A\u000D\u00AA\u00BA\u00C0-\u00FF]/,r=i.test(e.value);if(r&&"true"===e.dataset.hideMessageNrc){var n=document.getElementById("js-select-country").value;objTrk={tid:s.userActionTracker.TRK_USE_NRC,val:e.dataset.hideMessageNrcTracker+"#"+n},t.emit(s.events.TRK,objTrk)}return!r},S}),define("creditCardList",["pub_sub","constants","formValidator"],function(e,t,r){var s="mod-creditCardList",n="CreditCardList",o=".cvvFormValidator",a=function(){this.module=document.getElementById(s),this.creditCardListSelector='[name="creditCardTokenRadio"]',this.saveAndContinueSelector=".js-save-and-continue",this.selectedCreditCardToken=null,this.cards=null,this.confirmAndContinueButtons=null};return a.prototype.init=function(){if(!this.module)throw n+" is not loaded! Check if you have a node with the id: "+s;this.cvvFormValidator={},this.cvvFormItems={},this.cvvForm=this.module.querySelectorAll(o);for(var e=0;e<this.cvvForm.length;e++)this.cvvFormValidator[this.cvvForm[e].dataset.tokenId]=new r(this.cvvForm[e]),this.cvvFormItems[this.cvvForm[e].dataset.tokenId]=this.cvvForm[e];this.loadEvents(),this.selectedCreditCardToken=this.module.querySelector(this.creditCardListSelector+":checked")},a.prototype.loadEvents=function(){var e;if(this.cards=this.cards||this.module.querySelectorAll(this.creditCardListSelector),this.cards&&this.cards.length>0)for(e=0;e<this.cards.length;e++)this.cards[e].addEventListener("click",this.onCreditCardTokenSelected.bind(this));if(this.confirmAndContinueButtons=this.confirmAndContinueButtons||this.module.querySelectorAll(this.saveAndContinueSelector),this.confirmAndContinueButtons&&this.confirmAndContinueButtons.length>0)for(e=0;e<this.confirmAndContinueButtons.length;e++)this.confirmAndContinueButtons[e].addEventListener("click",this.useSelectedCreditCardToken)},a.prototype.unload=function(){var e;if(this.cards=this.cards||this.module.querySelectorAll(this.creditCardListSelector),this.cards&&this.cards.length>0)for(e=0;e<this.cards.length;e++)this.cards[e].removeEventListener("click",this.onCreditCardTokenSelected.bind(this));if(this.confirmAndContinueButtons=this.confirmAndContinueButtons||this.module.querySelectorAll(this.saveAndContinueSelector),this.confirmAndContinueButtons&&this.confirmAndContinueButtons.length>0)for(e=0;e<this.confirmAndContinueButtons.length;e++)this.confirmAndContinueButtons[e].removeEventListener("click",this.useSelectedCreditCardToken)},a.prototype.onCreditCardTokenSelected=function(e){if(e.currentTarget!==this.selectedCreditCardToken){this.selectedCreditCardToken=e.currentTarget,this.selectedCreditCardToken.setAttribute("checked","true");for(var t=this.module.querySelectorAll(this.creditCardListSelector),i=0;i<t.length;i++)t[i].checked||t[i].removeAttribute("checked")}},a.prototype.getSelectedToken=function(){return this.selectedCreditCardToken},a.prototype.useSelectedCreditCardToken=function(i){e.emit(t.events.CHECKOUT_SAVE_AND_CONTINUE)},a.prototype.validateCvvForm=function(){if(this.selectedCreditCardToken&&this.cvvFormValidator.hasOwnProperty(this.selectedCreditCardToken.value)){var e=this.cvvFormValidator[this.selectedCreditCardToken.value];if(e)return e.validateForm()}return!0},a.prototype.getCvvInput=function(){var e=null;if(this.selectedCreditCardToken&&this.cvvFormItems.hasOwnProperty(this.selectedCreditCardToken.value)&&this.cvvFormItems[this.selectedCreditCardToken.value].elements)var e=this.cvvFormItems[this.selectedCreditCardToken.value].elements[0];return e},a.prototype.getCreditCardTokenInfo=function(e){var t=null;if(e&&(this.cards=this.cards||this.module.querySelectorAll(this.creditCardListSelector),this.cards&&this.cards.length>0))for(i=0;i<this.cards.length;i++)if(this.cards[i].value===e){t=this.cards[i].dataset;break}return t},a}),define("promocode",["formValidator","pub_sub","constants","requester"],function(e,t,i,r){var s="mod-promoCode",n="promoCode",o=".summaryBox__promocode--input",a=".js-promocodeBtn",l=".js-promocodeBtn-remove",d=".promocode__disclaimer",c={DEFAULT:"promocode--default",LOADING:"promocode--loading",VALID:"promocode--valid",INVALID:"promocode--invalid",BLOCKED:"promocode--blocked"},u=function(){this.module=document.getElementById(s)};return u.prototype.init=function(){if(!this.module)throw n+" is not loaded! Check if you have a node with the id: "+s;this.promocodeRemoveButton=this.module.querySelector(l),this.promocodeButton=this.module.querySelector(a),this.promocodeInput=this.module.querySelector(o),this.promocodeForm=this.module,this.emptyPromocodeErrorMessage=this.promocodeInput.dataset.emptyErrorMessage,this.promocodeDisclaimer=document.querySelector(d),this.formValidator=new e(this.module,{validateOnBlur:!1,validateOnChange:!1}),this.formValidator.addCustomValidation(this.promocodeInput,this.promocodeValidation.bind(this),null,this.emptyPromocodeErrorMessage),this.formValidator.addAsyncCustomValidation(this.promocodeInput,this.promocodeAsyncValidation.bind(this),this.promocodeValidationParser,this.valid.bind(this),this.invalid.bind(this)),this.loadEvents()},u.prototype.loadEvents=function(){this.promocodeButton&&this.promocodeButton.addEventListener("click",this.submitPromocode.bind(this)),this.promocodeForm&&this.promocodeForm.addEventListener("submit",this.submitPromocode.bind(this)),this.promocodeRemoveButton.addEventListener("click",this.removePromocode.bind(this)),this.promocodeInput&&this.promocodeInput.addEventListener("focus",this.focusPromocode.bind(this))},u.prototype.submitPromocode=function(e){e.preventDefault(),this.setStatus(c.LOADING),this.formValidator.validateForm()},u.prototype.removePromocode=function(e){this.setStatus(c.LOADING),this.promocodeInput.disabled=!0;var s=this,n={promocode:this.promocodeInput.value,currentStep:this.module.dataset.currentStep},o=this.promocodeRemoveButton.getAttribute("data-endpoint-url"),a={method:"POST",data:JSON.stringify(n),url:o};r(a).then(function(e){s.resetInput(),objTrk={tid:i.userActionTracker.TRK_PROMOCODE_REMOVED,val:JSON.stringify({status:"removed"})},t.emit(i.events.TRK,objTrk),t.emit(i.events.UPDATE_SHIPPING_OPTIONS,e.data),t.emit(i.events.UPDATE_SUMMARY,e.data.summary)},function(e){t.emit(i.events.ERROR_RAISED,e)})},u.prototype.resetInput=function(){this.promocodeInput.value="",this.setStatus(c.DEFAULT),this.formValidator.removeValidations(),this.promocodeInput.disabled=!1,this.promocodeDisclaimer&&this.promocodeDisclaimer.classList.add("hide")},u.prototype.promocodeValidation=function(){var e=this.promocodeInput&&""!==this.promocodeInput.value;return e||(this.setStatus(c.INVALID),objTrk={tid:i.userActionTracker.TRK_PROMOCODE_APPLIED,val:JSON.stringify({status:"error",message:this.emptyPromocodeErrorMessage})},t.emit(i.events.TRK,objTrk)),e},u.prototype.promocodeAsyncValidation=function(){var e={promocode:this.promocodeInput.value,currentStep:this.module.dataset.currentStep},t=this.promocodeButton.getAttribute("data-endpoint-url"),i={method:"POST",data:JSON.stringify(e),url:t};return r(i)},u.prototype.promocodeValidationParser=function(e){return e.error?e.error.message:!0},u.prototype.valid=function(e){this.setStatus(c.VALID),objTrk={tid:i.userActionTracker.TRK_PROMOCODE_APPLIED,val:JSON.stringify({status:"success"})},t.emit(i.events.TRK,objTrk),this.promocodeButton.classList.add("hide"),this.promocodeRemoveButton.classList.remove("hide"),this.promocodeInput.disabled=!0,t.emit(i.events.UPDATE_SUMMARY,e.data.summary),t.emit(i.events.UPDATE_SHIPPING_OPTIONS,e.data)},u.prototype.invalid=function(e){e.status<500&&this.setStatus(c.INVALID),objTrk={tid:i.userActionTracker.TRK_PROMOCODE_APPLIED,val:JSON.stringify({status:"error",message:e.error.message})},t.emit(i.events.TRK,objTrk)},u.prototype.setStatus=function(e){this.module.classList.remove(c.BLOCKED),this.module.classList.remove(c.VALID),this.module.classList.remove(c.INVALID),this.module.classList.remove(c.LOADING),this.module.classList.remove(c.DEFAULT),this.module.classList.add(e)},u.prototype.focusPromocode=function(e){e.preventDefault(),objTrk={tid:i.userActionTracker.TRK_PROMOCODE_FOCUSED},t.emit(i.events.TRK,objTrk)},u.prototype.unload=function(){this.promocodeButton&&this.promocodeButton.removeEventListener("click",this.submitPromocode),this.promocodeForm&&this.promocodeForm.removeEventListener("submit",this.submitPromocode),this.promocodeInput&&this.promocodeInput.removeEventListener("focus",this.focusPromocode)},u}),define("modalMethods",[],function(){var e=document.getElementsByClassName("js-modalDialogClose"),t="#close",i=document.querySelectorAll("[data-toggle=modal]"),r={init:function(){for(var t=0;t<i.length;t++)i[t].addEventListener("click",this.open.bind(this));for(t=0;t<e.length;t++)e[t].addEventListener("click",this.close.bind(this))},open:function(){document.body.classList.add("modalDialog--open"),document.addEventListener("keydown",this.keydownHandler.bind(this))},close:function(){document.body.classList.remove("modalDialog--open"),document.removeEventListener("keydown",this.keydownHandler)},keydownHandler:function(e){27===e.keyCode&&this.closeModal()},closeModal:function(){window.location.hash=t,this.close()}};return r}),define("modal",["modalMethods"],function(e){var t=function(){e.init()};return t.prototype.closeModal=function(){e.closeModal()},new t}),define("dateOfBirthForm",["formValidator","chooser"],function(e,t){var i="mod-dateOfBirthForm",r="dateOfBirthForm",s=".js-birthDD",n=".js-birthMM",o=".js-birthYY",a=".js-dateOfBirth-select",l=function(e){this.module=e?document.getElementById(i+"-"+e):document.getElementById(i),this.formValidator=null,this.selectElements={},this.chooserElements={}};return l.prototype.init=function(){if(!this.module)throw r+" is not loaded! Check if you have a node with the id: "+i;this.formValidator=new e(this.module),this.selectElements=this.module.querySelectorAll(a),this.initChooser(),this.loadEvents()},l.prototype.initChooser=function(){for(var e=0;e<this.selectElements.length;e++)this.selectElements.hasOwnProperty(e)&&(this.chooserElements[this.selectElements[e].name]=new t(this.selectElements[e]))},l.prototype.loadEvents=function(){for(var e=0;e<this.selectElements.length;e++)this.selectElements.hasOwnProperty(e)&&this.chooserElements.hasOwnProperty(this.selectElements[e].name)&&this.chooserElements[this.selectElements[e].name].on("change",this.formValidator.validateInput.bind(this,this.selectElements[e]))},l.prototype.validateForm=function(){return this.formValidator?this.formValidator.validateForm():null},l.prototype.getDate=function(){var e=this.module.querySelector(s),t=this.module.querySelector(n),i=this.module.querySelector(o);return new Date(i.value,t.value-1,e.value).toISOString()},l}),define("billingAddressFactory",["addressForm"],function(e){var t="ebanx",i="#mod-addressForm-creditcard",r="#mod-addressForm-ebanx",s=function(){};return s.prototype.make=function(s,n){var o;switch(s){case t:o=n.querySelector(r);break;default:o=n.querySelector(i)}return new e(o)},s}),define("payment",["Base","requester","pub_sub","constants","es6ObjectAssign","popover","summaryBox","creditCardForm","addressForm","creditCardList","notifier","promocode","loading","modal","chooser","dateOfBirthForm","billingAddressFactory"],function(e,t,i,r,s,n,o,a,l,d,c,u,h,p,m,f,g){var v="mod-payment",y="Payment",C="paymentMethod-creditcard",b="paymentMethod-ebanx",E="#remember-cc",S=".js-remember-paypal-token",k=".js-remember-creditCard-token",T=".js-creditcard-form",A=".js-edit-billing-address",w=".js-cancel-edit-billing-address",I=".js-billing-address-form",x=".js-billing-address-card",P=".js-installmentsDropdown",L=".js-date-birth",M="[name=paymentMethodRadio]",_="[name=paymentMethodRadio]:checked",O=".js-creditcard-list",B=".js-add-credit-card",D=".js-show-creditcard-list",V=".js-creditcard-delete",F=".js-edit-token",R=".js-cancel-edit-token",N="[name=creditCardTokenRadio]",H=".js-payment-chooser";_creditCardDeleteEndPoint="Payment/DeleteToken",_saveAndContinueEndPoint="Payment/SaveAndContinue";var j=function(){this.module=document.getElementById(v),this.editTokenMode=!1,this.editCreditCardMode=!1,this.editBillingAddressMode=!1,this.creditCardPaymentMethodLoaded=!1,this.ebanxPaymentMethodLoaded=!1,this.selectedPaymentMethod=null,this.selectedPaymentMethodCode=null,this.paymentMethodSelectedData={},this.selectElements={},this.chooserElements={},s.polyfill()};return j.prototype.init=function(){if(!this.module)throw y+" is not loaded! Check if you have a node with the id: "+v;this.loadSelectors(),e.addModule("SummaryBox",new o,!0),e.addModule("Promocode",new u,!0),this.editCreditCardMode=this.module.dataset.hasOwnProperty("editCreditCard")&&!!this.module.dataset.editCreditCard==!0,this.isSelectedPaymentMethodCreditCard()&&this.loadCreditCardUI();for(var t=document.querySelectorAll("[data-toggle=popover]"),i=0;i<t.length;i++)new n(t[i]);this.initChooser(),this.loadEvents(),e.pageLoaded()},j.prototype.isSelectedPaymentMethodCreditCard=function(){return this.selectedPaymentMethod&&this.selectedPaymentMethod.dataset.hasOwnProperty("paymentmethodCreditcard")&&"True"===this.selectedPaymentMethod.dataset.paymentmethodCreditcard},j.prototype.loadCreditCardUI=function(){this.selectedPaymentMethod.id===C&&this.loadCreditCardPaymentMethodUI(),this.selectedPaymentMethod.id===b&&this.loadEbanxPaymentMethodUI()},j.prototype.configureBillingUI=function(){null!==this.billingAddressCardContainer?this.creditCardPaymentMethodLoaded||(this.displayBillingAddressCard(),this.hideBillingAddressForm()):this.creditCardPaymentMethodLoaded||(this.displayBillingAddressForm(),this.hideBillingAddressCard())},j.prototype.configureEbanxBillingUI=function(){null!==this.billingAddressCardContainer?this.ebanxPaymentMethodLoaded||(this.displayBillingAddressCard(),this.hideBillingAddressForm()):this.ebanxPaymentMethodLoaded||(this.displayBillingAddressForm(),this.hideBillingAddressCard())},j.prototype.configureCreditCardUI=function(){null===this.creditCardTokenContainer||this.editTokenMode||this.editCreditCardMode?(!this.creditCardPaymentMethodLoaded||this.editTokenMode||this.editCreditCardMode)&&(this.displayCreditCardForm(),this.hideCreditCardTokenList()):this.creditCardPaymentMethodLoaded||(this.displayCreditCardTokenList(),this.hideCreditCardForm())},j.prototype.configureEbanxUI=function(){this.displayCreditCardForm()},j.prototype.loadCreditCardPaymentMethodUI=function(){this.configureBillingUI(),this.configureCreditCardUI(),this.creditCardPaymentMethodLoaded=!0},j.prototype.loadDateOfBirthForm=function(){if(this.dateOfBirthForm){var t=e.getModule("DateOfBirthForm-"+this.selectedPaymentMethodCode);t||e.store("DateOfBirthForm-"+this.selectedPaymentMethodCode,new f(this.selectedPaymentMethodCode),!0)}},j.prototype.loadEbanxPaymentMethodUI=function(){this.loadDateOfBirthForm(),this.configureEbanxBillingUI(),this.configureEbanxUI(),this.ebanxPaymentMethodLoaded=!0},j.prototype.loadSelectors=function(){this.paymentMethodItems=this.module.querySelectorAll(M),this.selectedPaymentMethod=this.module.querySelector(_),this.creditCardTokenContainer=this.module.querySelector(O),this.addCreditCardFormButton=this.module.querySelector(B),this.showCreditCardList=this.module.querySelector(D),this.creditCardDeleteButton=this.module.querySelector(V),this.creditCardEditButton=this.module.querySelectorAll(F),this.creditCardCancelEditButton=this.module.querySelector(R),this.editBillingAddressButtons=this.module.querySelectorAll(A),this.cancelEditBillingAddressButtons=this.module.querySelectorAll(w),this.loadOrUpdateSelectorsBasedOnSelectedPaymentMethod(),this.rememberCreditCardCheckBox=this.module.querySelector(k),this.rememberPaypalTokenCheckBox=this.module.querySelector(S),this.selectElements=this.module.querySelectorAll(H)},j.prototype.loadOrUpdateSelectorsBasedOnSelectedPaymentMethod=function(){this.selectedPaymentMethodCode=this.selectedPaymentMethod.dataset.hasOwnProperty("paymentmethodCode")&&this.selectedPaymentMethod.dataset.paymentmethodCode,this.isSelectedPaymentMethodCreditCard()&&(this.billingAddressFormContainer=this.module.querySelector(I+"-"+this.selectedPaymentMethodCode),this.billingAddressCardContainer=this.module.querySelector(x+"-"+this.selectedPaymentMethodCode),this.creditCardFormContainer=this.module.querySelector(T+"-"+this.selectedPaymentMethodCode),this.editBillingAddressButton=this.billingAddressCardContainer&&this.billingAddressCardContainer.querySelector(A),this.cancelEditBillingAddressButton=this.billingAddressFormContainer&&this.billingAddressFormContainer.querySelector(w),this.installmentsDropdown=this.module.querySelector(P+"-"+this.selectedPaymentMethodCode),this.dateOfBirthForm=this.module.querySelector(L+"-"+this.selectedPaymentMethodCode))},j.prototype.loadEvents=function(){for(var t=0;t<this.paymentMethodItems.length;t++){var s=this.paymentMethodItems[t];s.addEventListener("change",this.changePaymentMethod.bind(this))}if(null!=this.addCreditCardFormButton&&this.addCreditCardFormButton.addEventListener("click",this.addCreditCardHandler.bind(this)),null!=this.showCreditCardList&&this.showCreditCardList.addEventListener("click",this.cancelAddCreditCardHandler.bind(this)),this.creditCardDeleteButton&&this.creditCardDeleteButton.addEventListener("click",this.deleteCreditCard.bind(this)),this.creditCardEditButton)for(t=0;t<this.creditCardEditButton.length;t++)this.creditCardEditButton[t].addEventListener("click",this.editCreditCard.bind(this));if(this.creditCardCancelEditButton&&this.creditCardCancelEditButton.addEventListener("click",this.cancelEditCreditCardToken.bind(this)),this.rememberCreditCardCheckBox&&this.rememberCreditCardCheckBox.addEventListener("change",this.rememberCreditCardTokenChanged.bind(this)),this.rememberPaypalTokenCheckBox&&this.rememberPaypalTokenCheckBox.addEventListener("change",this.rememberPaypalTokenChanged.bind(this)),this.editBillingAddressButtons)for(t=0;t<this.editBillingAddressButtons.length;t++)this.editBillingAddressButtons[t].addEventListener("click",this.editBillingAddressHandler.bind(this));if(this.cancelEditBillingAddressButtons)for(t=0;t<this.cancelEditBillingAddressButtons.length;t++)this.cancelEditBillingAddressButtons[t].addEventListener("click",this.cancelBillingAddressHandler.bind(this));i.on(r.events.CHECKOUT_SAVE_AND_CONTINUE,this.savePaymentMethod.bind(this)),i.on(r.events.ERROR_RAISED,e.displayNotifier)},j.prototype.initChooser=function(){for(var e=0;e<this.selectElements.length;e++)this.selectElements.hasOwnProperty(e)&&(this.chooserElements[this.selectElements[e].name]=new m(this.selectElements[e]))},j.prototype.unload=function(){e.unloadModules(),i.off(r.events.CHECKOUT_SAVE_AND_CONTINUE,this.savePaymentMethod),i.off(r.events.ERROR_RAISED,e.displayNotifier)},j.prototype.changePaymentMethod=function(e){var t=e.currentTarget,s=this.selectedPaymentMethod;(!s||t&&t.id&&s.id!==t.id)&&(this.selectedPaymentMethod=t,i.emit(r.events.PAYMENT_METHOD_CHANGED,{before:s,current:this.selectedPaymentMethod}),this.isSelectedPaymentMethodCreditCard()&&(this.loadOrUpdateSelectorsBasedOnSelectedPaymentMethod(),this.selectedPaymentMethod.id===C&&this.loadCreditCardPaymentMethodUI(),this.selectedPaymentMethod.id===b&&this.loadEbanxPaymentMethodUI()))},j.prototype.addCreditCardHandler=function(){this.resetCreditCardForm(),this.displayCreditCardForm(),this.hideCreditCardTokenList()},j.prototype.cancelAddCreditCardHandler=function(){this.hideCreditCardForm(),this.displayCreditCardTokenList(),this.editTokenMode=!1},j.prototype.getPaymentAgreementInfo=function(){var e=this.selectedPaymentMethod.dataset.paymentmethodCode,t=this.module.querySelector("#checkbox-"+e+"-agreement")||null,i={CanCreateToken:null!==t,CreateToken:t?t.checked:!0};return i.CanCreateToken||(i.Tokens=[{Id:this.selectedPaymentMethod.dataset.tokenId||null,IsSelected:!0}]),i},j.prototype.getCreditCardTokenInfo=function(t){if(!t)return null;var i={},r=t.value,s=t.dataset.paymentOption,n=t.dataset.expirationMonth,o=t.dataset.expirationYear,a=t.dataset.number,l=t.dataset.name,d=e.getModule("CreditCardList"),c=d.getCvvInput();if(i={Id:r,IsSelected:!0,
PaymentOption:s,ExpirationMonth:n,ExpirationYear:o,CardLast4Numbers:a,HolderName:l},c){var u=c.value;i.SecurityCode=u}return{Tokens:[i]}},j.prototype.getCreditCardFormInfo=function(){var t={},i=e.getModule("CreditCardForm-"+this.selectedPaymentMethodCode),r=i.getCreditCardInfo();if(this.editTokenMode){var s=e.getModule("CreditCardList"),n=s.getSelectedToken();t.Tokens=[{Id:n.value,IsSelected:!0,PaymentOption:n.dataset.paymentOption,CardLast4Numbers:n.dataset.number,HolderName:n.dataset.name,SecurityCode:r.SecurityCode,ExpirationMonth:r.ExpirationMonth,ExpirationYear:r.ExpirationYear}]}else{var o=this.module.querySelector(E),a={CreateToken:o?o.checked:!0};t=Object.assign(r,a)}return t},j.prototype.savePaymentMethod=function(){if(this.selectedPaymentMethod){var t={},s={Id:this.selectedPaymentMethod.dataset.paymentmethodId,Code:this.selectedPaymentMethod.dataset.paymentmethodCode,IsSelected:!0,Text:this.selectedPaymentMethod.dataset.paymentmethodText};if(this.isSelectedPaymentMethodCreditCard()){var n=!0,o=!0,a=!0,l=!0,d={},c={},u={};if(this.installmentsDropdown&&(s.Instalments={SelectedInstalment:this.installmentsDropdown.value}),this.dateOfBirthForm){var p=e.getModule("DateOfBirthForm-"+this.selectedPaymentMethodCode);a=p.validateForm(),a&&(u.DateOfBirth=p.getDate())}if(this.isBillingAddressFormVisible()){var m=e.getModule("AddressForm-"+this.selectedPaymentMethodCode);l=m.validate();var f=m.getSpecificAddressFormError();if(!l||f&&f.message)return l?i.emit(r.events.FORM_VALIDATION_FAILED,f.message):i.emit(r.events.FORM_VALIDATION_FAILED),void i.emit(h.MODULE_LOADED,this.module);var g=m.serialize();g.Id=m.module.dataset.addressId,d={AddressForm:g}}if(this.isCreditCardFormVisible()){var v=e.getModule("CreditCardForm-"+this.selectedPaymentMethodCode);o=v.validateForm(),o&&(c=this.getCreditCardFormInfo())}else if(this.isCreditCardTokenListVisible()){var y=e.getModule("CreditCardList");if(n=y.validateCvvForm()){var C=y.getSelectedToken();c=this.getCreditCardTokenInfo(C)}}if(!n||!o||!a)return i.emit(r.events.FORM_VALIDATION_FAILED),void i.emit(h.MODULE_LOADED,this.module);t=Object.assign(d,c,u)}else t=this.getPaymentAgreementInfo();t=Object.assign(s,t),this.postPaymentData(t).then(function(e){if(e.redirectUrl){var t=document.createEvent("CustomEvent");t.initCustomEvent(r.events.CHECKOUT_SAVE_AND_CONTINUE_SUCCESS,!1,!1,{detail:{step:"Payment"}}),window.dispatchEvent(t),window.location.href=e.redirectUrl}},function(e){return e.redirectUrl?void(window.location.href=e.redirectUrl):(i.emit(r.events.ERROR_RAISED,e),void i.emit(h.MODULE_LOADED,this.module))}.bind(this))}},j.prototype.postPaymentData=function(e){var r={method:"POST",data:JSON.stringify(e),url:_saveAndContinueEndPoint};return i.emit(h.MODULE_LOADING,{context:this.module,isFixed:!0}),t(r)},j.prototype.editCreditCard=function(t){if(t.currentTarget){var s=t.currentTarget.dataset.tokenId;if(s){this.creditCardFormContainer.dataset.tokenId=s,this.creditCardFormContainer.dataset.editMode="true",this.editTokenMode=!0;var n=e.getModule("CreditCardList"),o=n.getCreditCardTokenInfo(s);if(this.configureCreditCardUI(),o){var l=e.getModule("CreditCardForm-"+this.selectedPaymentMethodCode);l||(l=new a(this.selectedPaymentMethodCode),e.store("CreditCardForm-"+this.selectedPaymentMethodCode,l,!0)),l.fillInCreditCardForm(o),i.emit(r.events.TOGGLE_CREDIT_CARD_LIST_VISIBILITY)}}}},j.prototype.deleteCreditCard=function(){p.closeModal();var e={tokenId:this.creditCardFormContainer.dataset.tokenId},s={method:"POST",data:JSON.stringify(e),url:_creditCardDeleteEndPoint},n=this;i.emit(h.MODULE_LOADING,{context:this.module,isFixed:!0}),t(s).then(function(t){if(t){n.resetCreditCardForm();var r=n.module.querySelectorAll(N);if(r&&r.length>1){n.hideCreditCardForm(),n.displayCreditCardTokenList();var s=n.module.querySelector("#creditCardToken-"+e.tokenId);if(s){var o=s.parentElement;o.parentNode.removeChild(o)}n.module.querySelector(N).checked=!0}else{var a=n.module.querySelector(".js-add-token-actions");a&&a.classList&&a.classList.add("hide")}i.emit(h.MODULE_LOADED,n.module)}},function(e){i.emit(r.events.ERROR_RAISED,e),i.emit(h.MODULE_LOADED,n.module)})},j.prototype.resetCreditCardForm=function(){var t=this.creditCardFormContainer;t.dataset.tokenId="",t.dataset.editMode="false",this.editTokenMode=!1,this.editcreditCardMode=!1;var i=e.getModule("CreditCardForm-"+this.selectedPaymentMethodCode);i&&i.cleanCreditCardForm()},j.prototype.cancelEditCreditCardToken=function(){this.resetCreditCardForm(),this.hideCreditCardForm(),this.displayCreditCardTokenList()},j.prototype.editBillingAddressHandler=function(e){e.preventDefault(),this.displayBillingAddressForm(),this.hideBillingAddressCard()},j.prototype.cancelBillingAddressHandler=function(e){e.preventDefault(),this.displayBillingAddressCard(),this.hideBillingAddressForm()},j.prototype.displayBillingAddressForm=function(){var t=new g;this.billingAddressFormContainer&&(this.billingAddressFormContainer.classList.remove("hide"),this.editBillingAddressMode=!0,e.store("AddressForm-"+this.selectedPaymentMethodCode,t.make(this.selectedPaymentMethodCode,this.module),!0))},j.prototype.hideBillingAddressForm=function(){this.billingAddressFormContainer&&(this.billingAddressFormContainer.classList.add("hide"),this.editBillingAddressMode=!1)},j.prototype.isBillingAddressFormVisible=function(){return this.billingAddressFormContainer&&!this.billingAddressFormContainer.classList.contains("hide")},j.prototype.displayBillingAddressCard=function(){this.billingAddressCardContainer&&this.billingAddressCardContainer.classList.remove("hide")},j.prototype.hideBillingAddressCard=function(){this.billingAddressCardContainer&&this.billingAddressCardContainer.classList.add("hide")},j.prototype.isBillingAddressCardVisible=function(){return this.billingAddressCardContainer&&!this.billingAddressCardContainer.classList.contains("hide")},j.prototype.displayCreditCardForm=function(){this.creditCardFormContainer&&(this.creditCardFormContainer.classList.remove("hide"),e.store("CreditCardForm-"+this.selectedPaymentMethodCode,new a(this.selectedPaymentMethodCode),!0))},j.prototype.hideCreditCardForm=function(){this.creditCardFormContainer&&this.creditCardFormContainer.classList.add("hide")},j.prototype.isCreditCardFormVisible=function(){return this.creditCardFormContainer&&!this.creditCardFormContainer.classList.contains("hide")},j.prototype.displayCreditCardTokenList=function(){this.creditCardTokenContainer&&(this.creditCardTokenContainer.classList.remove("hide"),e.store("CreditCardList",new d,!0))},j.prototype.hideCreditCardTokenList=function(){this.creditCardTokenContainer&&this.creditCardTokenContainer.classList.add("hide")},j.prototype.rememberCreditCardTokenChanged=function(){objTrk={tid:r.userActionTracker.TRK_SAVE_CREDIT_CARD_TOKEN,val:JSON.stringify(this.rememberCreditCardCheckBox.checked)},i.emit(r.events.TRK,objTrk)},j.prototype.rememberPaypalTokenChanged=function(){objTrk={tid:r.userActionTracker.TRK_SAVE_PAYPAL_TOKEN,val:JSON.stringify(this.rememberPaypalTokenCheckBox.checked)},i.emit(r.events.TRK,objTrk)},j.prototype.isCreditCardTokenListVisible=function(){return this.creditCardTokenContainer&&!this.creditCardTokenContainer.classList.contains("hide")},j}),require(["payment"],function(e){var t=new e;t.init()}),define("pages/payment",function(){});